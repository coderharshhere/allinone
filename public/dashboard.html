<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllInOne MP ‚Äì Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase v9 Compat (Zyada stable) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Devanagari', sans-serif; 
            background: linear-gradient(135deg, #f0f4f8 0%, #e6f7ff 100%);
            overflow-x: hidden;
        }
        .loading-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
        }
        .loading-spinner {
            width: 60px; height: 60px;
            border: 6px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .sidebar {
            width: 280px; position: fixed; left: 0; top: 0; height: 100vh;
            background: linear-gradient(180deg, #1e3a8a 0%, #0f296b 100%);
            z-index: 40; overflow-x: hidden; transition: all 0.3s;
        }
        .sidebar.collapsed { width: 80px; }
        .sidebar.collapsed .sidebar-text { display: none; }
        
        .main-content {
            margin-left: 280px; padding: 90px 20px 20px;
            transition: margin-left 0.3s;
        }
        .main-content.collapsed { margin-left: 80px; }
        
        .top-bar {
            position: fixed; top: 0; left: 280px; right: 0; height: 70px;
            background: white; z-index: 30; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; transition: left 0.3s;
        }
        .top-bar.collapsed { left: 80px; }
        
        .status-badge {
            padding: 6px 16px; border-radius: 50px; font-size: 13px;
            font-weight: 600; display: inline-flex; align-items: center; gap: 6px;
            cursor: pointer; border: 2px solid transparent;
        }
        .status-complete { background: #dcfce7; color: #166534; border-color: #bbf7d0; }
        .status-pending { background: #ffedd5; color: #9a3412; border-color: #fed7aa; }
        .status-reject { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
        .status-processing { background: #dbeafe; color: #1e40af; border-color: #bfdbfe; }
        
        .action-btn {
            padding: 0.6rem; border-radius: 10px; border: none; cursor: pointer;
            width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s;
        }
        .action-btn:hover { transform: translateY(-2px); }
        .action-view { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .action-edit { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .action-delete { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        
        .nav-item {
            display: flex; align-items: center; gap: 16px;
            padding: 14px 20px; margin-bottom: 8px; cursor: pointer;
            color: white; border-radius: 16px; transition: all 0.3s;
        }
        .nav-item:hover { background: rgba(255,255,255,0.15); }
        .nav-item.active { background: rgba(255,255,255,0.25); }
        
        .page-section { display: none; animation: fadeIn 0.5s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.65); z-index: 1000; align-items: center; justify-content: center;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: 24px; max-width: 950px; width: 100%;
            max-height: 95vh; overflow-y: auto; position: relative;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.35);
        }
        .modal-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white; padding: 28px 32px; border-radius: 24px 24px 0 0;
        }
        
        .detail-row { display: flex; padding: 12px 0; border-bottom: 1px dashed #e2e8f0; }
        .detail-label { font-weight: 700; color: #475569; width: 40%; }
        .detail-value { color: #0f172a; font-weight: 600; width: 60%; }
        
        .stat-card {
            background: white; border-radius: 20px; padding: 24px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            position: relative; overflow: hidden; transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.15); }
        .stat-card::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, #1e3a8a, #3b82f6);
        }
        
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f8fafc; padding: 16px; text-align: left; font-weight: 700; }
        .data-table td { padding: 16px; border-bottom: 1px solid #f1f5f9; }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white; border: none; padding: 14px 28px; border-radius: 14px;
            font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 10px;
            transition: all 0.3s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(59,130,246,0.4); }
        
        .btn-secondary {
            background: white; color: #1e3a8a; border: 2px solid #3b82f6;
            padding: 12px 26px; border-radius: 14px; font-weight: 600; cursor: pointer;
            display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s;
        }
        .btn-secondary:hover { background: #f1f5ff; }
        
        .form-control {
            width: 100%; padding: 14px 16px; border: 1px solid #cbd5e1;
            border-radius: 14px; font-family: inherit; font-size: 1rem;
            transition: all 0.3s;
        }
        .form-control:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
        
        .auth-error-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; color: white; text-align: center;
        }
        
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; padding-top: 80px; }
            .top-bar { left: 0; padding: 0 15px; }
            .detail-row { flex-direction: column; }
            .detail-label, .detail-value { width: 100%; }
        }
        
        @media print {
            body * { visibility: hidden; }
            #pdfContent, #pdfContent * { visibility: visible; }
            #pdfContent { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen" class="loading-screen">
    <div class="loading-spinner"></div>
    <h2 class="text-2xl font-bold text-gray-800">AllInOne MP ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä</h2>
    <p class="mt-3 text-gray-600">‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
    <p id="loadingStatus" class="mt-2 text-sm text-blue-600">Initializing...</p>
</div>

<!-- Auth Error Screen -->
<div id="authErrorScreen" class="auth-error-screen">
    <i class="fas fa-lock text-6xl mb-6"></i>
    <h1 class="text-3xl font-bold mb-4">üîí ‡§™‡§π‡•Å‡§Ç‡§ö ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</h1>
    <p class="text-xl mb-2">‡§á‡§∏ ‡§™‡•á‡§ú ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à</p>
    <p class="text-lg opacity-75 mb-8">‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç</p>
    <button onclick="window.location.href='https://allinonemp.harshtiwari.in/adminlogin.html'" 
            class="bg-white text-blue-900 px-8 py-3 rounded-xl font-bold hover:bg-blue-50 transition">
        <i class="fas fa-sign-in-alt mr-2"></i>‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç
    </button>
</div>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="p-6 border-b border-blue-700/50">
        <div class="flex items-center gap-3 mb-6">
            <div class="bg-white w-12 h-12 rounded-lg flex items-center justify-center shadow-md">
                <span class="text-blue-900 font-bold text-xl">MP</span>
            </div>
            <div class="sidebar-text">
                <h1 class="text-xl font-bold text-white">AllInOne-MP</h1>
                <p class="text-xs text-blue-200">‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§™‡•à‡§®‡§≤</p>
            </div>
        </div>
        <div class="sidebar-text">
            <div class="bg-white/15 p-4 rounded-xl border border-white/20">
                <p class="text-xs text-blue-200 mb-1"><i class="fas fa-user-shield mr-2"></i>‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï</p>
                <p class="font-bold text-white text-lg" id="sidebarAdminName">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
            </div>
        </div>
    </div>
    
    <nav class="mt-4 p-4">
        <div class="sidebar-text px-3 py-2 text-xs font-bold text-blue-300 uppercase mb-3">‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç</div>
        <div class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-home w-6"></i>
            <span class="sidebar-text">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</span>
        </div>
        <div class="nav-item" onclick="showSection('applications')">
            <i class="fas fa-file-signature w-6"></i>
            <span class="sidebar-text">‡§Ü‡§µ‡•á‡§¶‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</span>
        </div>
        <div class="nav-item" onclick="showSection('newApplication')">
            <i class="fas fa-plus-circle w-6"></i>
            <span class="sidebar-text">‡§®‡§Ø‡§æ ‡§Ü‡§µ‡•á‡§¶‡§®</span>
        </div>
        <div class="nav-item" onclick="showSection('analysis')">
            <i class="fas fa-chart-pie w-6"></i>
            <span class="sidebar-text">‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</span>
        </div>
        <div class="nav-item" onclick="showSection('settings')">
            <i class="fas fa-cog w-6"></i>
            <span class="sidebar-text">‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</span>
        </div>
    </nav>
    
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-white/20">
        <button onclick="logout()" class="w-full bg-white/10 hover:bg-red-500/20 text-white py-3 rounded-xl transition flex items-center justify-center gap-2">
            <i class="fas fa-sign-out-alt"></i>
            <span class="sidebar-text">‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç</span>
        </button>
    </div>
</aside>

<!-- Top Bar -->
<div class="top-bar" id="topBar">
    <div class="flex items-center gap-4">
        <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-100 rounded-lg lg:hidden">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="hidden md:flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-xl">
            <i class="fas fa-search text-gray-500"></i>
            <input type="text" placeholder="‡§Ü‡§µ‡•á‡§¶‡§® ‡§ñ‡•ã‡§ú‡•á‡§Ç..." class="bg-transparent border-none outline-none w-48">
        </div>
    </div>
    <div class="flex items-center gap-4">
        <div class="relative">
            <button class="p-2 hover:bg-gray-100 rounded-xl relative" id="notificationBtn">
                <i class="fas fa-bell text-xl text-gray-700"></i>
                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center" id="notifCount">0</span>
            </button>
        </div>
        <div class="flex items-center gap-3 cursor-pointer" onclick="showSection('settings')">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold" id="topBarAvatar">A</div>
            <div class="hidden md:block">
                <div class="font-bold text-gray-800" id="adminName">‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï</div>
                <div class="text-xs text-gray-500" id="adminEmail">Loading...</div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<main class="main-content" id="mainContent">

    <!-- DASHBOARD SECTION -->
    <div id="dashboard" class="page-section active">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                            <i class="fas fa-tachometer-alt text-blue-600"></i>
                            ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, <span id="welcomeAdminName" class="text-blue-600">‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï</span>
                        </h1>
                        <p class="text-gray-500 mt-1">‡§Ü‡§ú: <span id="currentDate"></span></p>
                    </div>
                    <div class="bg-green-50 text-green-700 px-4 py-2 rounded-xl font-medium flex items-center gap-2">
                        <i class="fas fa-circle text-xs animate-pulse"></i>
                        <span>Firebase: <span id="firebaseStatus">‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span></span>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="stat-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">‡§ï‡•Å‡§≤ ‡§Ü‡§µ‡•á‡§¶‡§®</p>
                            <h3 class="text-3xl font-bold text-gray-800" id="statTotal">0</h3>
                        </div>
                        <div class="bg-blue-100 text-blue-600 w-12 h-12 rounded-xl flex items-center justify-center text-xl">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">‡§≤‡§Ç‡§¨‡§ø‡§§</p>
                            <h3 class="text-3xl font-bold text-gray-800" id="statPending">0</h3>
                        </div>
                        <div class="bg-yellow-100 text-yellow-600 w-12 h-12 rounded-xl flex items-center justify-center text-xl">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">‡§™‡•Ç‡§∞‡•ç‡§£</p>
                            <h3 class="text-3xl font-bold text-gray-800" id="statComplete">0</h3>
                        </div>
                        <div class="bg-green-100 text-green-600 w-12 h-12 rounded-xl flex items-center justify-center text-xl">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</p>
                            <h3 class="text-3xl font-bold text-gray-800" id="statRejected">0</h3>
                        </div>
                        <div class="bg-red-100 text-red-600 w-12 h-12 rounded-xl flex items-center justify-center text-xl">
                            <i class="fas fa-times-circle"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Table -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h2 class="text-xl font-bold text-gray-800">‡§π‡§æ‡§≤ ‡§ï‡•á ‡§Ü‡§µ‡•á‡§¶‡§®</h2>
                    <div class="flex gap-3">
                        <select id="statusFilter" onchange="filterData()" class="form-control w-40 py-2 text-sm">
                            <option value="">‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø</option>
                            <option value="pending">‡§≤‡§Ç‡§¨‡§ø‡§§</option>
                            <option value="processing">‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó</option>
                            <option value="complete">‡§™‡•Ç‡§∞‡•ç‡§£</option>
                            <option value="reject">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</option>
                        </select>
                        <input type="text" id="searchInput" onkeyup="searchData()" placeholder="‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç..." class="form-control w-64 py-2 text-sm">
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
                                <th>‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
                                <th>‡§∏‡•á‡§µ‡§æ</th>
                                <th>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th>
                                <th>‡§§‡§ø‡§•‡§ø</th>
                                <th>‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
                                <th>‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable">
                            <tr>
                                <td colspan="7" class="text-center py-12 text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                                    <p>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW APPLICATION FORM -->
    <div id="newApplication" class="page-section">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                        <i class="fas fa-plus-circle text-green-600"></i>
                        ‡§®‡§Ø‡§æ ‡§Ü‡§µ‡•á‡§¶‡§®
                    </h1>
                    <button onclick="showSection('dashboard')" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i> ‡§µ‡§æ‡§™‡§∏
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <form id="applicationForm" onsubmit="submitApplication(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ <span class="text-red-500">*</span></label>
                            <input type="text" id="appName" class="form-control" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§™‡§ø‡§§‡§æ/‡§™‡§§‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ <span class="text-red-500">*</span></label>
                            <input type="text" id="appFatherName" class="form-control" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ <span class="text-red-500">*</span></label>
                            <input type="tel" id="appMobile" class="form-control" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ <span class="text-red-500">*</span></label>
                            <input type="text" id="appAadhar" class="form-control" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø</label>
                            <input type="date" id="appDob" class="form-control">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§≤‡§ø‡§Ç‡§ó</label>
                            <select id="appGender" class="form-control">
                                <option value="">‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                <option value="male">‡§™‡•Å‡§∞‡•Å‡§∑</option>
                                <option value="female">‡§Æ‡§π‡§ø‡§≤‡§æ</option>
                                <option value="other">‡§Ö‡§®‡•ç‡§Ø</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ <span class="text-red-500">*</span></label>
                            <select id="appService" class="form-control" required>
                                <option value="">‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                <option value="samagra">‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä</option>
                                <option value="mpbhoj">‡§è‡§Æ‡§™‡•Ä ‡§≠‡•ã‡§ú</option>
                                <option value="scholarship">‡§õ‡§æ‡§§‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø</option>
                                <option value="pension">‡§™‡•á‡§Ç‡§∂‡§®</option>
                                <option value="housing">‡§Ü‡§µ‡§æ‡§∏</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§ú‡§ø‡§≤‡§æ <span class="text-red-500">*</span></label>
                            <select id="appDistrict" class="form-control" required>
                                <option value="">‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                <option value="bhopal">‡§≠‡•ã‡§™‡§æ‡§≤</option>
                                <option value="indore">‡§á‡§Ç‡§¶‡•å‡§∞</option>
                                <option value="jabalpur">‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</option>
                                <option value="gwalior">‡§ó‡•ç‡§µ‡§æ‡§≤‡§ø‡§Ø‡§∞</option>
                                <option value="ujjain">‡§â‡§ú‡•ç‡§ú‡•à‡§®</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§™‡§§‡§æ <span class="text-red-500">*</span></label>
                            <textarea id="appAddress" class="form-control" rows="3" required></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§™‡§ø‡§® ‡§ï‡•ã‡§°</label>
                            <input type="text" id="appPincode" class="form-control">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§à‡§Æ‡•á‡§≤</label>
                            <input type="email" id="appEmail" class="form-control">
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-4 mt-8 pt-6 border-t">
                        <button type="button" onclick="resetForm()" class="btn-secondary">‡§∞‡•Ä‡§∏‡•á‡§ü</button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> ‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Other sections placeholder -->
    <div id="applications" class="page-section">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h1 class="text-2xl font-bold mb-4">‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡•á‡§¶‡§®</h1>
                <p>‡§Ø‡§π ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡•á‡§¶‡§® ‡§¶‡§ø‡§ñ‡§æ‡§è‡§ó‡§æ (‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡•Ä ‡§§‡§∞‡§π)</p>
            </div>
        </div>
    </div>
    
    <div id="analysis" class="page-section">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h1 class="text-2xl font-bold mb-4">‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</h1>
                <canvas id="analysisChart" height="100"></canvas>
            </div>
        </div>
    </div>
    
    <div id="settings" class="page-section">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h1 class="text-2xl font-bold mb-4">‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h1>
                <p>‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§î‡§∞ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§Ø‡§π‡§æ‡§Å ‡§π‡•ã‡§Ç‡§ó‡•Ä</p>
            </div>
        </div>
    </div>

</main>

<!-- View Details Modal -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header no-print">
            <h2 class="text-2xl font-bold flex items-center gap-3">
                <i class="fas fa-file-invoice"></i>
                ‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£
            </h2>
            <button onclick="closeModal()" class="text-white hover:text-gray-200 text-2xl ml-auto">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div id="pdfContent" class="p-8">
            <div class="text-center mb-8 border-b-2 border-blue-600 pb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-800 to-blue-500 rounded-full flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">MP</div>
                <h1 class="text-3xl font-bold text-blue-900">‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§∏‡§∞‡§ï‡§æ‡§∞</h1>
                <p class="text-lg text-gray-600 mt-2">AllInOne MP ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ - ‡§Ü‡§µ‡•á‡§¶‡§® ‡§∞‡§∏‡•Ä‡§¶</p>
                <div class="mt-4 inline-block bg-blue-50 text-blue-800 px-6 py-2 rounded-full font-mono font-bold text-lg border-2 border-blue-200" id="receiptAppNo">AIO-MP-001</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
                    <div id="applicantDetails">
                        <!-- Data populated by JS -->
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
                    <div id="applicationDetails">
                        <!-- Data populated by JS -->
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-8 pt-6 border-t-2 border-gray-200 text-gray-600 text-sm">
                <p>‡§Ø‡§π ‡§è‡§ï ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§ú‡§®‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§∏‡•Ä‡§¶ ‡§π‡•à</p>
                <p class="mt-1">AllInOne MP Portal | https://allinonemp.harshtiwari.in</p>
            </div>
        </div>

        <div class="p-6 border-t bg-gray-50 flex flex-wrap justify-between gap-3 no-print">
            <div class="flex gap-2">
                <button onclick="updateStatus('processing')" class="btn-primary bg-blue-600">‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó</button>
                <button onclick="updateStatus('complete')" class="btn-primary bg-green-600">‡§™‡•Ç‡§∞‡•ç‡§£</button>
                <button onclick="updateStatus('reject')" class="btn-primary bg-red-600">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</button>
            </div>
            <div class="flex gap-2">
                <button onclick="downloadWord()" class="btn-secondary">
                    <i class="fas fa-file-word"></i> Word
                </button>
                <button onclick="downloadPDF()" class="btn-secondary">
                    <i class="fas fa-file-pdf"></i> PDF
                </button>
                <button onclick="printReceipt()" class="btn-secondary">
                    <i class="fas fa-print"></i> ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="text-2xl font-bold"><i class="fas fa-edit mr-2"></i>‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</h2>
            <button onclick="closeEditModal()" class="text-white hover:text-gray-200 text-2xl ml-auto">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="editForm" onsubmit="saveEdit(event)">
                <input type="hidden" id="editId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">‡§®‡§æ‡§Æ</label>
                        <input type="text" id="editName" class="form-control" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                        <input type="text" id="editFather" class="form-control" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</label>
                        <input type="tel" id="editMobile" class="form-control" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</label>
                        <select id="editStatus" class="form-control">
                            <option value="pending">‡§≤‡§Ç‡§¨‡§ø‡§§</option>
                            <option value="processing">‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó</option>
                            <option value="complete">‡§™‡•Ç‡§∞‡•ç‡§£</option>
                            <option value="reject">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeEditModal()" class="btn-secondary">‡§∞‡§¶‡•ç‡§¶</button>
                    <button type="submit" class="btn-primary">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// üî• Firebase Configuration - APNI CONFIG YAHAN DALEN
const firebaseConfig = {
    apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
    authDomain: "allinone-mp.firebaseapp.com",
    projectId: "allinone-mp",
    storageBucket: "allinone-mp.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abcdef123456"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Global Variables
let allApplications = [];
let currentDetailId = null;
let currentUser = null;

// üöÄ Initialize App
document.addEventListener('DOMContentLoaded', async function() {
    // Check Auth State
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;
            console.log("‚úÖ User logged in:", user.email);
            
            // Update UI with user info
            const userName = user.displayName || user.email.split('@')[0];
            document.getElementById('adminName').textContent = userName;
            document.getElementById('sidebarAdminName').textContent = userName;
            document.getElementById('welcomeAdminName').textContent = userName;
            document.getElementById('topBarAvatar').textContent = userName.charAt(0).toUpperCase();
            document.getElementById('adminEmail').textContent = user.email;
            
            // Set current date
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('hi-IN', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            
            // Load Data
            await loadApplications();
            
            // Hide loading
            hideLoading();
            
        } else {
            console.log("‚ùå No user logged in");
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('authErrorScreen').style.display = 'flex';
            
            // Redirect after 3 seconds
            setTimeout(() => {
                window.location.href = 'https://allinonemp.harshtiwari.in/adminlogin.html';
            }, 3000);
        }
    });
});

// üìä Load Applications from Firestore
async function loadApplications() {
    try {
        document.getElementById('firebaseStatus').textContent = '‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡•á‡§°';
        document.getElementById('firebaseStatus').className = 'font-bold text-green-600';
        
        // Real-time listener
        db.collection('applications')
            .orderBy('createdAt', 'desc')
            .onSnapshot((snapshot) => {
                console.log("üì• Data received:", snapshot.docs.length, "documents");
                
                allApplications = snapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt ? data.createdAt.toDate() : new Date(),
                        updatedAt: data.updatedAt ? data.updatedAt.toDate() : new Date()
                    };
                });
                
                renderTable(allApplications);
                updateStats(allApplications);
                
            }, (error) => {
                console.error("‚ùå Error:", error);
                document.getElementById('firebaseStatus').textContent = '‡§è‡§∞‡§∞';
                document.getElementById('firebaseStatus').className = 'font-bold text-red-600';
                
                document.getElementById('dataTable').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-12 text-red-500">
                            <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                            <p>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${error.message}</p>
                            <button onclick="location.reload()" class="btn-primary mt-4">‡§∞‡•Ä‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç</button>
                        </td>
                    </tr>
                `;
            });
            
    } catch (error) {
        console.error("Initialization error:", error);
    }
}

// üìã Render Table
function renderTable(data) {
    const tbody = document.getElementById('dataTable');
    const notifCount = document.getElementById('notifCount');
    
    if (data.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-12 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-3"></i>
                    <p>‡§ï‡•ã‡§à ‡§Ü‡§µ‡•á‡§¶‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>
                </td>
            </tr>
        `;
        if(notifCount) notifCount.textContent = '0';
        return;
    }
    
    let html = '';
    let pendingCount = 0;
    
    data.forEach((item) => {
        if(item.status === 'pending' || !item.status) pendingCount++;
        
        const appNo = item.applicationNumber || `AIO-MP-${item.id.substr(0,8).toUpperCase()}`;
        const name = item.applicantName || item.name || "N/A";
        const service = getServiceName(item.serviceType);
        const mobile = item.mobileNumber || item.mobile || "-";
        const date = formatDate(item.createdAt);
        const status = item.status || 'pending';
        
        const statusClass = status === 'complete' ? 'status-complete' : 
                           status === 'reject' ? 'status-reject' : 
                           status === 'processing' ? 'status-processing' : 'status-pending';
        
        const statusText = status === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' : 
                          status === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : 
                          status === 'processing' ? '‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó' : '‡§≤‡§Ç‡§¨‡§ø‡§§';
        
        html += `
        <tr class="hover:bg-gray-50 transition">
            <td class="font-mono font-bold text-blue-800">${appNo}</td>
            <td class="font-bold text-gray-800">${name}</td>
            <td><span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">${service}</span></td>
            <td>${mobile}</td>
            <td class="text-gray-600">${date}</td>
            <td>
                <span class="status-badge ${statusClass}" onclick="quickUpdateStatus('${item.id}', '${status}')">
                    <i class="fas ${status === 'complete' ? 'fa-check' : status === 'reject' ? 'fa-times' : 'fa-clock'} mr-1"></i>
                    ${statusText}
                </span>
            </td>
            <td>
                <div class="flex gap-2">
                    <button onclick="viewDetails('${item.id}')" class="action-btn action-view" title="‡§µ‡§ø‡§µ‡§∞‡§£">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button onclick="openEditModal('${item.id}')" class="action-btn action-edit" title="‡§è‡§°‡§ø‡§ü">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteApp('${item.id}')" class="action-btn action-delete" title="‡§°‡§ø‡§≤‡•Ä‡§ü">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
        `;
    });
    
    tbody.innerHTML = html;
    if(notifCount) notifCount.textContent = pendingCount;
}

// üìä Update Stats
function updateStats(data) {
    const total = data.length;
    const pending = data.filter(a => a.status === 'pending' || !a.status).length;
    const complete = data.filter(a => a.status === 'complete').length;
    const rejected = data.filter(a => a.status === 'reject').length;
    
    document.getElementById('statTotal').textContent = total;
    document.getElementById('statPending').textContent = pending;
    document.getElementById('statComplete').textContent = complete;
    document.getElementById('statRejected').textContent = rejected;
}

// üëÅÔ∏è View Details - FIXED
function viewDetails(id) {
    console.log("Viewing details for:", id);
    const item = allApplications.find(a => a.id === id);
    if (!item) {
        alert("‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
        return;
    }
    
    currentDetailId = id;
    
    // App Number
    const appNo = item.applicationNumber || `AIO-MP-${item.id.substr(0,8).toUpperCase()}`;
    document.getElementById('receiptAppNo').textContent = appNo;
    
    // Applicant Details
    const appDetails = document.getElementById('applicantDetails');
    appDetails.innerHTML = `
        <div class="detail-row">
            <div class="detail-label">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</div>
            <div class="detail-value">${item.applicantName || item.name || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§™‡§ø‡§§‡§æ/‡§™‡§§‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ</div>
            <div class="detail-value">${item.fatherName || item.guardianName || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</div>
            <div class="detail-value">${item.mobileNumber || item.mobile || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§à‡§Æ‡•á‡§≤</div>
            <div class="detail-value">${item.email || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞</div>
            <div class="detail-value">${maskAadhar(item.aadharNumber)}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§≤‡§ø‡§Ç‡§ó</div>
            <div class="detail-value">${getGenderText(item.gender)}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø</div>
            <div class="detail-value">${item.dob ? formatDate(new Date(item.dob)) : '-'}</div>
        </div>
    `;
    
    // Application Details
    const applDetails = document.getElementById('applicationDetails');
    applDetails.innerHTML = `
        <div class="detail-row">
            <div class="detail-label">‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</div>
            <div class="detail-value">${getServiceName(item.serviceType)}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§ú‡§ø‡§≤‡§æ</div>
            <div class="detail-value">${getDistrictName(item.district)}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§™‡§§‡§æ</div>
            <div class="detail-value">${item.address || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§™‡§ø‡§® ‡§ï‡•ã‡§°</div>
            <div class="detail-value">${item.pincode || '-'}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§Ü‡§µ‡•á‡§¶‡§® ‡§§‡§ø‡§•‡§ø</div>
            <div class="detail-value">${formatDate(item.createdAt)}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</div>
            <div class="detail-value">
                <span class="status-badge status-${item.status || 'pending'}">
                    ${item.status === 'complete' ? '‚úì ‡§™‡•Ç‡§∞‡•ç‡§£' : 
                      item.status === 'reject' ? '‚úó ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : 
                      item.status === 'processing' ? '‚ü≥ ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó' : '‚è± ‡§≤‡§Ç‡§¨‡§ø‡§§'}
                </span>
            </div>
        </div>
    `;
    
    document.getElementById('detailModal').classList.add('active');
}

// üíæ Submit New Application
async function submitApplication(e) {
    e.preventDefault();
    
    const data = {
        applicantName: document.getElementById('appName').value,
        fatherName: document.getElementById('appFatherName').value,
        mobileNumber: document.getElementById('appMobile').value,
        aadharNumber: document.getElementById('appAadhar').value,
        dob: document.getElementById('appDob').value,
        gender: document.getElementById('appGender').value,
        serviceType: document.getElementById('appService').value,
        district: document.getElementById('appDistrict').value,
        address: document.getElementById('appAddress').value,
        pincode: document.getElementById('appPincode').value,
        email: document.getElementById('appEmail').value,
        status: 'pending',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        const docRef = await db.collection('applications').add(data);
        console.log("Document written with ID:", docRef.id);
        
        alert('‚úÖ ‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!');
        document.getElementById('applicationForm').reset();
        showSection('dashboard');
        
    } catch (error) {
        console.error("Error adding document:", error);
        alert('‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message);
    }
}

// ‚úèÔ∏è Open Edit Modal
function openEditModal(id) {
    const item = allApplications.find(a => a.id === id);
    if(!item) return;
    
    currentDetailId = id;
    document.getElementById('editId').value = id;
    document.getElementById('editName').value = item.applicantName || item.name || '';
    document.getElementById('editFather').value = item.fatherName || '';
    document.getElementById('editMobile').value = item.mobileNumber || item.mobile || '';
    document.getElementById('editStatus').value = item.status || 'pending';
    
    document.getElementById('editModal').classList.add('active');
}

// üíæ Save Edit
async function saveEdit(e) {
    e.preventDefault();
    if(!currentDetailId) return;
    
    try {
        await db.collection('applications').doc(currentDetailId).update({
            applicantName: document.getElementById('editName').value,
            fatherName: document.getElementById('editFather').value,
            mobileNumber: document.getElementById('editMobile').value,
            status: document.getElementById('editStatus').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert('‚úÖ ‡§Ö‡§™‡§°‡•á‡§ü ‡§∏‡§´‡§≤!');
        closeEditModal();
        
    } catch (error) {
        alert('‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message);
    }
}

// üîÑ Quick Status Update
async function quickUpdateStatus(id, currentStatus) {
    const statuses = ['pending', 'processing', 'complete', 'reject'];
    const currentIndex = statuses.indexOf(currentStatus);
    const nextStatus = statuses[(currentIndex + 1) % statuses.length];
    
    try {
        await db.collection('applications').doc(id).update({
            status: nextStatus,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log("Status updated to:", nextStatus);
    } catch (error) {
        alert('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message);
    }
}

// üîÑ Update Status from Modal
async function updateStatus(status) {
    if(!currentDetailId) return;
    
    try {
        await db.collection('applications').doc(currentDetailId).update({
            status: status,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert('‚úÖ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à!');
        closeModal();
    } catch (error) {
        alert('‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message);
    }
}

// üóëÔ∏è Delete Application
async function deleteApp(id) {
    if(!confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏‡•á ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) return;
    
    try {
        await db.collection('applications').doc(id).delete();
        alert('‚úÖ ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!');
    } catch (error) {
        alert('‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message);
    }
}

// üìÑ Download Word Document - FIXED
function downloadWord() {
    if(!currentDetailId) {
        alert('‡§ï‡•ã‡§à ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ö‡§Ø‡§®‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç!');
        return;
    }
    
    const item = allApplications.find(a => a.id === currentDetailId);
    if(!item) {
        alert('‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!');
        return;
    }
    
    const appNo = item.applicationNumber || `AIO-MP-${item.id.substr(0,8).toUpperCase()}`;
    
    const htmlContent = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
    <head>
        <meta charset="UTF-8">
        <title>Application Receipt</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
            .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #1e3a8a; padding-bottom: 20px; }
            .title { font-size: 28px; font-weight: bold; color: #1e3a8a; margin: 10px 0; }
            .subtitle { font-size: 18px; color: #666; margin-bottom: 15px; }
            .app-number { background: #dbeafe; color: #1e40af; padding: 10px 20px; border-radius: 8px; display: inline-block; margin: 10px 0; font-weight: bold; font-size: 18px; }
            .section { margin: 25px 0; background: #f8fafc; padding: 20px; border-radius: 10px; }
            .section-title { font-size: 20px; font-weight: bold; color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; }
            .field { margin: 12px 0; display: flex; border-bottom: 1px dashed #cbd5e1; padding-bottom: 8px; }
            .field-label { font-weight: bold; min-width: 200px; color: #374151; font-size: 15px; }
            .field-value { color: #1f2937; font-weight: 600; flex: 1; }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="title">‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§∏‡§∞‡§ï‡§æ‡§∞</div>
            <div class="subtitle">AllInOne MP ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</div>
            <div class="app-number">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${appNo}</div>
        </div>
        
        <div class="section">
            <div class="section-title">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£</div>
            <div class="field">
                <div class="field-label">‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ:</div>
                <div class="field-value">${item.applicantName || item.name || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§™‡§ø‡§§‡§æ/‡§™‡§§‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ:</div>
                <div class="field-value">${item.fatherName || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞:</div>
                <div class="field-value">${item.mobileNumber || item.mobile || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§à‡§Æ‡•á‡§≤:</div>
                <div class="field-value">${item.email || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞:</div>
                <div class="field-value">${maskAadhar(item.aadharNumber)}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø:</div>
                <div class="field-value">${item.dob || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§≤‡§ø‡§Ç‡§ó:</div>
                <div class="field-value">${getGenderText(item.gender)}</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</div>
            <div class="field">
                <div class="field-label">‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:</div>
                <div class="field-value">${getServiceName(item.serviceType)}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§ú‡§ø‡§≤‡§æ:</div>
                <div class="field-value">${getDistrictName(item.district)}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§™‡§§‡§æ:</div>
                <div class="field-value">${item.address || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§™‡§ø‡§®‡§ï‡•ã‡§°:</div>
                <div class="field-value">${item.pincode || 'N/A'}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§Ü‡§µ‡•á‡§¶‡§® ‡§§‡§ø‡§•‡§ø:</div>
                <div class="field-value">${formatDate(item.createdAt)}</div>
            </div>
            <div class="field">
                <div class="field-label">‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</div>
                <div class="field-value">${item.status === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' : item.status === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : item.status === 'processing' ? '‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó' : '‡§≤‡§Ç‡§¨‡§ø‡§§'}</div>
            </div>
        </div>
    </body>
    </html>`;
    
    const blob = new Blob(['\ufeff', htmlContent], { type: 'application/msword' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `Receipt_${appNo}.doc`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// üìÑ Download PDF
function downloadPDF() {
    const element = document.getElementById('pdfContent');
    const opt = {
        margin: 0.5,
        filename: 'application_receipt.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    
    html2pdf().set(opt).from(element).save();
}

// üñ®Ô∏è Print
function printReceipt() {
    window.print();
}

// üîç Filter Data
function filterData() {
    const status = document.getElementById('statusFilter').value;
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    let filtered = allApplications;
    
    if(status) {
        filtered = filtered.filter(a => (a.status || 'pending') === status);
    }
    
    if(search) {
        filtered = filtered.filter(a => 
            (a.applicantName || '').toLowerCase().includes(search) ||
            (a.mobileNumber || '').includes(search)
        );
    }
    
    renderTable(filtered);
}

function searchData() {
    filterData();
}

// üß≠ Navigation
function showSection(sectionId) {
    document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if(item.getAttribute('onclick')?.includes(sectionId)) {
            item.classList.add('active');
        }
    });
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('mainContent');
    const topBar = document.getElementById('topBar');
    
    sidebar.classList.toggle('collapsed');
    main.classList.toggle('collapsed');
    topBar.classList.toggle('collapsed');
    
    if(window.innerWidth < 1024) {
        sidebar.classList.toggle('active');
    }
}

function closeModal() {
    document.getElementById('detailModal').classList.remove('active');
}

function closeEditModal() {
    document.getElementById('editModal').classList.remove('active');
}

function resetForm() {
    document.getElementById('applicationForm').reset();
}

function logout() {
    auth.signOut().then(() => {
        window.location.href = 'https://allinonemp.harshtiwari.in/adminlogin.html';
    });
}

function hideLoading() {
    document.getElementById('loadingScreen').style.display = 'none';
}

// Helper Functions
function formatDate(date) {
    if(!date || date == 'Invalid Date') return "-";
    try {
        const d = new Date(date);
        return d.toLocaleDateString('hi-IN', { day: '2-digit', month: 'long', year: 'numeric' });
    } catch(e) {
        return "-";
    }
}

function getServiceName(type) {
    const names = {
        'samagra': '‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä',
        'mpbhoj': '‡§è‡§Æ‡§™‡•Ä ‡§≠‡•ã‡§ú',
        'scholarship': '‡§õ‡§æ‡§§‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø',
        'pension': '‡§™‡•á‡§Ç‡§∂‡§®',
        'housing': '‡§Ü‡§µ‡§æ‡§∏'
    };
    return names[type] || type || '‡§Ö‡§®‡•ç‡§Ø';
}

function getDistrictName(dist) {
    const names = {
        'bhopal': '‡§≠‡•ã‡§™‡§æ‡§≤', 'indore': '‡§á‡§Ç‡§¶‡•å‡§∞', 'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',
        'gwalior': '‡§ó‡•ç‡§µ‡§æ‡§≤‡§ø‡§Ø‡§∞', 'ujjain': '‡§â‡§ú‡•ç‡§ú‡•à‡§®'
    };
    return names[dist] || dist || '-';
}

function getGenderText(g) {
    const genders = { 'male': '‡§™‡•Å‡§∞‡•Å‡§∑', 'female': '‡§Æ‡§π‡§ø‡§≤‡§æ', 'other': '‡§Ö‡§®‡•ç‡§Ø' };
    return genders[g] || g || '-';
}

function maskAadhar(aadhar) {
    if(!aadhar) return '-';
    const str = aadhar.toString().replace(/\s/g, '');
    if(str.length === 12) return str.substr(0,4) + ' XXXX XXXX ' + str.substr(8);
    return str;
}
</script>

</body>
</html>
