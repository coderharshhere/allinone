<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllInOne MP ‚Äì Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');
        
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            overflow-x: hidden;
        }

        /* Sidebar Animation */
        .sidebar {
            transition: all 0.3s ease;
            width: var(--sidebar-width);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar.collapsed .sidebar-text {
            display: none;
        }

        .main-content {
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-collapsed {
            margin-left: 80px;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-pending { 
            background: linear-gradient(135deg, #fff8e6 0%, #ffd54f 100%); 
            color: #e69500; 
            border: 1px solid #ffd54f; 
        }

        .status-complete { 
            background: linear-gradient(135deg, #e8f5e9 0%, #81c784 100%); 
            color: #2e76d2; 
            border: 1px solid #81c784; 
        }

        .status-reject { 
            background: linear-gradient(135deg, #ffebee 0%, #ef9a9a 100%); 
            color: #c62828; 
            border: 1px solid #ef9a9a; 
        }

        .status-processing { 
            background: linear-gradient(135deg, #e3f2fd 0%, #90caf9 100%); 
            color: #1565c0; 
            border: 1px solid #64b5f6; 
        }

        /* Action Buttons */
        .action-btn {
            transition: all 0.2s ease;
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .action-view { 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
            color: #1976d2; 
        }

        .action-delete { 
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); 
            color: #c62828; 
        }

        .action-edit { 
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); 
            color: #2e7d32; 
        }

        .action-approve { 
            background: linear-gradient(135deg, #e8f5e9 0%, #a5d6a7 100%); 
            color: #1b5e20; 
        }

        /* Table Row Hover */
        .table-row {
            transition: all 0.2s ease;
        }

        .table-row:hover {
            background-color: #f8fafc;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transform: translateX(5px);
        }

        /* Filter Container */
        .filter-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        /* Stats Cards */
        .stats-card {
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--card-color-start), var(--card-color-end));
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stats-total::before { 
            --card-color-start: #1e3a8a; 
            --card-color-end: #3b82f6; 
        }

        .stats-pending::before { 
            --card-color-start: #b45309; 
            --card-color-end: #f59e0b; 
        }

        .stats-complete::before { 
            --card-color-start: #166534; 
            --card-color-end: #22c55e; 
        }

        .stats-rejected::before { 
            --card-color-start: #b91c1c; 
            --card-color-end: #ef4444; 
        }

        /* Animations */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        .fade-in-delay {
            animation: fadeIn 0.6s ease forwards;
            animation-delay: 0.2s;
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(59, 130, 246, 0.2);
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2.5rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.7;
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
            color: #1e293b;
        }

        /* Notification Bell */
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }

        /* Dark Mode Support */
        .dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .dark-mode .stats-card,
        .dark-mode .filter-container,
        .dark-mode table {
            background: #1e293b;
            border-color: #334155;
        }

        .dark-mode .table-row:hover {
            background-color: #334155;
        }

        /* PDF Template Styles */
        #pdfContent {
            position: fixed;
            top: 0;
            left: 0;
            width: 794px;
            min-height: 1123px;
            background: #ffffff;
            visibility: hidden;
            opacity: 1;
            z-index: 9999;
        }

        .pdf-page {
            background: white;
            padding: 95px;
            position: relative;
            width: 794px !important;
            min-height: 1123px !important;
            height: auto !important;
            font-family: 'Noto Sans Devanagari', 'Arial Unicode MS', sans-serif !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
            color: #334155 !important;
            box-sizing: border-box !important;
            margin: 0 !important;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #1e3a8a;
            padding-bottom: 15px;
        }

        .pdf-title {
            font-size: 24px !important;
            font-weight: 700 !important;
            color: #1e3a8a !important;
            margin: 5px 0 !important;
        }

        .pdf-qr-container {
            position: absolute !important;
            top: 95px !important;
            right: 95px !important;
            width: 120px !important;
            height: 120px !important;
            border: 1px solid #cbd5e1 !important;
            padding: 8px !important;
            background: white !important;
            border-radius: 8px !important;
            box-sizing: border-box !important;
        }

        @page {
            size: A4;
            margin: 0;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #pdfContent, #pdfContent * {
                visibility: visible;
            }
            #pdfContent {
                position: absolute;
                left: 0;
                top: 0;
            }
        }

        /* Advanced Features */
        .chart-container {
            position: relative;
            height: 300px;
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .notification-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .notification-item:hover {
            background: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(5px);
        }

        .notification-item.unread {
            background: #eff6ff;
            border-left-color: #3b82f6;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 1000;
                height: 100vh;
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
            }
            .main-content.sidebar-open {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- AUTHENTICATION GUARD -->
    <script>
        // üîí Authentication Check - Redirect if not logged in
        (function() {
            const currentPage = window.location.href;
            const loginPage = 'https://allinonemp.harshtiwari.in/adminlogin.html';
            
            // Check if user is logged in via localStorage
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            const adminToken = localStorage.getItem('adminToken');
            
            if (!isLoggedIn || !adminToken) {
                // Redirect to login page
                if (!currentPage.includes('adminlogin.html')) {
                    window.location.href = loginPage;
                }
            } else {
                // Verify token expiration (24 hours)
                const loginTime = localStorage.getItem('loginTime');
                const currentTime = new Date().getTime();
                
                if (loginTime && (currentTime - loginTime > 24 * 60 * 60 * 1000)) {
                    // Token expired
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('loginTime');
                    localStorage.removeItem('adminEmail');
                    localStorage.removeItem('adminName');
                    window.location.href = loginPage;
                }
            }
        })();
    </script>

    <!-- SIDEBAR -->
    <aside class="sidebar bg-gradient-to-b from-blue-900 to-blue-700 text-white h-screen fixed left-0 top-0 z-40 shadow-2xl">
        <div class="p-5 border-b border-blue-600">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 backdrop-blur-sm p-2 rounded-xl">
                        <div class="bg-white w-10 h-10 rounded flex items-center justify-center">
                            <span class="text-blue-900 font-bold text-xl">MP</span>
                        </div>
                    </div>
                    <div class="sidebar-text">
                        <h1 class="text-xl font-bold">AllInOne-MP</h1>
                        <p class="text-xs opacity-90 mt-1">Admin Panel</p>
                    </div>
                </div>
                <button id="sidebarToggle" class="sidebar-text p-2 hover:bg-white/10 rounded-lg transition">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <div class="mb-2 sidebar-text">
                <div class="bg-white/10 backdrop-blur-sm p-3 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs opacity-90">‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ</p>
                            <p class="font-bold mt-1" id="sidebarAdminName">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
                        </div>
                        <div class="bg-yellow-300 text-blue-900 font-bold w-8 h-8 rounded-full flex items-center justify-center text-sm">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mt-2 p-3">
            <ul class="space-y-1">
                <li>
                    <a href="#" class="flex items-center gap-3 p-3 rounded-lg bg-white/10 backdrop-blur-sm w-full sidebar-text">
                        <i class="fas fa-home text-xl"></i>
                        <span class="font-medium">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 transition w-full sidebar-text">
                        <i class="fas fa-list text-xl"></i>
                        <span class="font-medium">‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡•Ç‡§ö‡•Ä</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 transition w-full sidebar-text">
                        <i class="fas fa-chart-bar text-xl"></i>
                        <span class="font-medium">‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 transition w-full sidebar-text">
                        <i class="fas fa-users text-xl"></i>
                        <span class="font-medium">‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 transition w-full sidebar-text">
                        <i class="fas fa-cog text-xl"></i>
                        <span class="font-medium">‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-blue-600">
            <div class="flex items-center justify-between sidebar-text">
                <div>
                    <p class="text-xs opacity-90">¬© 2026 AllInOne MP</p>
                    <p class="text-xs mt-1 opacity-75">‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ 2.0</p>
                </div>
                <button onclick="logout()" class="p-2 hover:bg-white/10 rounded-lg transition" title="‡§≤‡•â‡§ó‡§Ü‡§â‡§ü">
                    <i class="fas fa-sign-out-alt text-lg"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content flex-1 ml-72 container mx-auto px-4 py-6 transition-all">
        <!-- HEADER -->
        <header class="bg-white rounded-2xl shadow-lg p-5 mb-6 fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <i class="fas fa-tachometer-alt text-blue-600"></i>
                        ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°
                    </h1>
                    <p class="text-gray-500 mt-1 text-sm">‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§∏‡§∞‡§ï‡§æ‡§∞ - ‡§è‡§ï ‡§µ‡§ø‡§Ç‡§°‡•ã ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®</p>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="relative group">
                        <button class="relative p-2 hover:bg-gray-100 rounded-full transition" id="notificationBtn">
                            <i class="fas fa-bell text-xl text-gray-700"></i>
                            <span class="notification-badge">5</span>
                        </button>
                        <div class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl py-2 hidden z-50" id="notificationDropdown">
                            <div class="p-3 border-b border-gray-100">
                                <h3 class="font-bold text-gray-800">‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç</h3>
                                <p class="text-xs text-gray-500 mt-1">5 ‡§®‡§à ‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç</p>
                            </div>
                            <div class="max-h-96 overflow-y-auto">
                                <div class="notification-item unread p-3 hover:bg-blue-50 transition cursor-pointer">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <p class="font-medium text-gray-800">‡§®‡§Ø‡§æ ‡§Ü‡§µ‡•á‡§¶‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§Ü</p>
                                            <p class="text-xs text-gray-500 mt-1">‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ ‡§Ü‡§µ‡•á‡§¶‡§®</p>
                                        </div>
                                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">‡§Ö‡§≠‡•Ä</span>
                                    </div>
                                </div>
                                <div class="notification-item unread p-3 hover:bg-blue-50 transition cursor-pointer">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <p class="font-medium text-gray-800">‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</p>
                                            <p class="text-xs text-gray-500 mt-1">MP ‡§≠‡•ã‡§ú ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Ü‡§µ‡•á‡§¶‡§® #AIO-123456</p>
                                        </div>
                                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">5 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§π‡§≤‡•á</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 border-t border-gray-100 text-center">
                                <button class="text-blue-600 hover:text-blue-800 font-medium text-sm">‡§∏‡§≠‡•Ä ‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative group">
                        <div class="flex items-center gap-3 cursor-pointer p-2 hover:bg-gray-100 rounded-full transition" id="profileButton">
                            <div class="bg-gradient-to-br from-yellow-300 to-yellow-400 text-blue-900 font-bold w-10 h-10 rounded-full flex items-center justify-center text-lg">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="hidden md:block">
                                <p class="font-bold text-sm" id="adminName">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
                                <p class="text-xs text-gray-500" id="adminEmail">-</p>
                            </div>
                            <i class="fas fa-chevron-down text-xs hidden md:block"></i>
                        </div>
                        <div class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl py-2 hidden z-50" id="profileDropdown">
                            <a href="#" class="flex items-center px-4 py-2 text-gray-800 hover:bg-blue-50 transition">
                                <i class="fas fa-user-circle mr-3 text-blue-600"></i> ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤
                            </a>
                            <a href="#" class="flex items-center px-4 py-2 text-gray-800 hover:bg-blue-50 transition">
                                <i class="fas fa-cog mr-3 text-blue-600"></i> ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏
                            </a>
                            <a href="#" class="flex items-center px-4 py-2 text-gray-800 hover:bg-blue-50 transition">
                                <i class="fas fa-history mr-3 text-blue-600"></i> ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ‡§ø‡§ü‡•Ä ‡§≤‡•â‡§ó
                            </a>
                            <div class="border-t my-1"></div>
                            <a href="#" onclick="logout()" class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 transition">
                                <i class="fas fa-sign-out-alt mr-3"></i> ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Search and Filters -->
        <div class="filter-container fade-in">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="md:col-span-1">
                    <div class="relative">
                        <input id="searchInput" placeholder="‡§®‡§æ‡§Æ ‡§Ø‡§æ ID ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç..."
                            class="border border-gray-300 p-3 w-full pl-10 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>
                <div>
                    <select id="serviceFilter" class="border border-gray-300 p-3 w-full rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">‡§∏‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç</option>
                        <option value="samagra">‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä</option>
                        <option value="ekyc">‡§à-‡§ï‡•á‡§µ‡§æ‡§à‡§∏‡•Ä</option>
                        <option value="mpbhoj">‡§è‡§Æ‡§™‡•Ä ‡§≠‡•ã‡§ú ‡§Ø‡•ã‡§ú‡§®‡§æ</option>
                        <option value="scholarship">‡§õ‡§æ‡§§‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø</option>
                        <option value="pension">‡§™‡•á‡§Ç‡§∂‡§®</option>
                    </select>
                </div>
                <div>
                    <select id="statusFilter" class="border border-gray-300 p-3 w-full rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç</option>
                        <option value="pending">‡§≤‡§Ç‡§¨‡§ø‡§§</option>
                        <option value="complete">‡§™‡•Ç‡§∞‡•ç‡§£</option>
                        <option value="reject">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</option>
                        <option value="processing">‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button id="clearFilters" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg w-full transition flex items-center justify-center">
                        <i class="fas fa-redo mr-2"></i> ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç
                    </button>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row justify-between items-center gap-3 pt-2 border-t border-gray-100">
                <div class="flex flex-wrap gap-2">
                    <button id="exportCSV" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-file-csv mr-2"></i> CSV ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§
                    </button>
                    <button id="exportExcel" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-file-excel mr-2"></i> Excel ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§
                    </button>
                    <button id="printView" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-print mr-2"></i> ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§µ‡•ç‡§Ø‡•Ç
                    </button>
                </div>
                <div class="text-sm text-gray-600 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                    <span>‡§ï‡•Å‡§≤ ‡§Ü‡§µ‡•á‡§¶‡§®: <span id="totalApplications" class="font-bold text-blue-700">0</span></span>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6 fade-in">
            <div class="stats-card stats-total bg-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">‡§ï‡•Å‡§≤ ‡§Ü‡§µ‡•á‡§¶‡§®</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="statTotal">0</p>
                        <p class="text-green-600 text-sm mt-1 flex items-center">
                            <i class="fas fa-arrow-up mr-1 text-xs"></i>
                            <span id="statTotalGrowth">+12%</span> ‡§™‡§ø‡§õ‡§≤‡•á ‡§Æ‡§æ‡§π ‡§∏‡•á
                        </p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-xl">
                        <i class="fas fa-file-alt text-blue-600 text-3xl"></i>
                    </div>
                </div>
            </div>
            <div class="stats-card stats-pending bg-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">‡§≤‡§Ç‡§¨‡§ø‡§§</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="statPending">0</p>
                        <p class="text-amber-600 text-sm mt-1 flex items-center">
                            <i class="fas fa-clock mr-1 text-xs"></i>
                            <span id="statPendingCount">0</span> ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§π‡•á‡§§‡•Å
                        </p>
                    </div>
                    <div class="bg-amber-100 p-4 rounded-xl">
                        <i class="fas fa-hourglass-half text-amber-500 text-3xl"></i>
                    </div>
                </div>
            </div>
            <div class="stats-card stats-complete bg-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">‡§™‡•Ç‡§∞‡•ç‡§£</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="statComplete">0</p>
                        <p class="text-green-600 text-sm mt-1 flex items-center">
                            <i class="fas fa-check-circle mr-1 text-xs"></i>
                            <span id="statCompleteRate">95%</span> ‡§∏‡§´‡§≤‡§§‡§æ ‡§¶‡§∞
                        </p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-xl">
                        <i class="fas fa-check-circle text-green-600 text-3xl"></i>
                    </div>
                </div>
            </div>
            <div class="stats-card stats-rejected bg-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§</p>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="statRejected">0</p>
                        <p class="text-red-600 text-sm mt-1 flex items-center">
                            <i class="fas fa-times-circle mr-1 text-xs"></i>
                            <span id="statRejectionRate">5%</span> ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§‡§ø ‡§¶‡§∞
                        </p>
                    </div>
                    <div class="bg-red-100 p-4 rounded-xl">
                        <i class="fas fa-times-circle text-red-600 text-3xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6 fade-in-delay">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-line text-blue-600 mr-2"></i>
                    ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§Ü‡§µ‡•á‡§¶‡§® ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø
                </h3>
                <div class="chart-container">
                    <canvas id="applicationsChart"></canvas>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-blue-600 mr-2"></i>
                    ‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§µ‡§ø‡§§‡§∞‡§£
                </h3>
                <div class="chart-container">
                    <canvas id="servicesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Applications Table -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden fade-in-delay">
            <div class="p-4 md:p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-list mr-3 text-blue-600"></i>
                    ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§Ü‡§µ‡•á‡§¶‡§®
                </h2>
                <div class="mt-3 md:mt-0 flex flex-wrap gap-2">
                    <div class="relative">
                        <input type="date" id="dateFrom" class="border border-gray-300 p-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <label class="absolute -top-2 left-2 bg-white px-1 text-xs text-gray-500">‡§∏‡•á</label>
                    </div>
                    <div class="relative">
                        <input type="date" id="dateTo" class="border border-gray-300 p-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <label class="absolute -top-2 left-2 bg-white px-1 text-xs text-gray-500">‡§§‡§ï</label>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gradient-to-r from-blue-800 to-blue-600 text-white">
                        <tr>
                            <th class="p-4 text-left font-medium">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
                            <th class="p-4 text-left font-medium">‡§®‡§æ‡§Æ</th>
                            <th class="p-4 text-left font-medium">‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
                            <th class="p-4 text-left font-medium hidden md:table-cell">‡§∏‡§Æ‡§ó‡•ç‡§∞ / ‡§∏‡§¶‡§∏‡•ç‡§Ø ID</th>
                            <th class="p-4 text-left font-medium hidden sm:table-cell">‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
                            <th class="p-4 text-left font-medium">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
                            <th class="p-4 text-left font-medium">‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <!-- Loading state -->
                        <tr>
                            <td colspan="7" class="p-8 text-center">
                                <div class="loading-spinner"></div>
                                <p class="mt-4 text-gray-600 font-medium">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="emptyState" class="empty-state hidden">
                <i class="fas fa-file-search text-blue-300"></i>
                <h3>‡§ï‡•ã‡§à ‡§Ü‡§µ‡•á‡§¶‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                <p class="mt-2">‡§Ü‡§™‡§ï‡•á ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§®‡§¶‡§Ç‡§°‡•ã‡§Ç ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§ï‡•ã‡§à ‡§Ü‡§µ‡•á‡§¶‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>
                <button id="resetFilters" class="mt-4 bg-blue-600 text-white px-6 py-2.5 rounded-lg hover:bg-blue-700 transition flex items-center mx-auto shadow-lg">
                    <i class="fas fa-filter mr-2"></i> ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>
            <div class="p-4 border-t border-gray-100 flex flex-col sm:flex-row justify-between items-center">
                <p class="text-gray-500 text-sm mb-2 sm:mb-0">‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•É‡§∑‡•ç‡§† ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç:
                    <select class="border border-gray-300 rounded px-2 py-1 ml-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option>10</option>
                        <option>25</option>
                        <option selected>50</option>
                        <option>100</option>
                    </select>
                </p>
                <div class="flex items-center space-x-2">
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition">
                        <i class="fas fa-chevron-left mr-1"></i> ‡§™‡§ø‡§õ‡§≤‡§æ
                    </button>
                    <span class="font-medium px-4 py-2 bg-blue-50 text-blue-700 rounded-lg">1</span>
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition">
                        ‡§Ö‡§ó‡§≤‡§æ <i class="fas fa-chevron-right ml-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- DETAILS MODAL -->
    <div id="detailModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 p-4">
        <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh]">
            <div class="bg-gradient-to-r from-blue-800 to-blue-600 text-white p-6 flex justify-between items-center rounded-t-2xl">
                <h2 class="font-bold text-xl flex items-center">
                    <i class="fas fa-file-invoice mr-3"></i>
                    ‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£
                </h2>
                <div class="flex space-x-3">
                    <button onclick="printApplication()" class="bg-white text-blue-800 px-5 py-2.5 rounded-lg font-medium hover:bg-blue-50 transition flex items-center shadow-md">
                        <i class="fas fa-print mr-2"></i> ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü
                    </button>
                    <button onclick="downloadPDF()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-5 py-2.5 rounded-lg font-medium transition flex items-center shadow-md">
                        <i class="fas fa-file-pdf mr-2"></i> PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
                    </button>
                    <button onclick="closeDetails()" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>
            </div>
            <div id="detailBody" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-5 overflow-y-auto flex-1">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="p-5 bg-gray-50 border-t border-gray-100 rounded-b-2xl">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        <span>‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: <span id="modalApplicationNo" class="font-bold text-blue-700">AIO-XXXXXXXX</span></span>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="updateStatus('pending')" class="bg-amber-100 text-amber-800 px-5 py-2.5 rounded-lg font-medium hover:bg-amber-200 transition flex items-center shadow-sm">
                            <i class="fas fa-clock mr-2"></i> ‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§∞‡§ñ‡•á‡§Ç
                        </button>
                        <button onclick="updateStatus('complete')" class="bg-green-100 text-green-800 px-5 py-2.5 rounded-lg font-medium hover:bg-green-200 transition flex items-center shadow-sm">
                            <i class="fas fa-check mr-2"></i> ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                        <button onclick="updateStatus('reject')" class="bg-red-100 text-red-800 px-5 py-2.5 rounded-lg font-medium hover:bg-red-200 transition flex items-center shadow-sm">
                            <i class="fas fa-times mr-2"></i> ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF TEMPLATE -->
    <div id="pdfContent">
        <div class="pdf-page">
            <div class="pdf-header">
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                    <div style="background: #1e3a8a; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 24px;">
                        MP
                    </div>
                    <div style="text-align: left;">
                        <div style="font-size: 20px; font-weight: bold; color: #1e3a8a;">‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§∏‡§∞‡§ï‡§æ‡§∞</div>
                        <div style="font-size: 14px; color: #4b5563;">Government of Madhya Pradesh</div>
                    </div>
                </div>
                <h1 class="pdf-title">AllInOne MP ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ - ‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</h1>
                <p class="pdf-subtitle">‡§∏‡§≠‡•Ä ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï‡§≤ ‡§ñ‡§ø‡§°‡§º‡§ï‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä</p>
                <div class="pdf-app-no">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: <span id="pdfApplicationNo">AIO-XXXXXXXX</span></div>
            </div>
            <div class="pdf-qr-container" id="pdfQR"></div>
            <table class="pdf-details-table">
                <thead>
                    <tr>
                        <th style="width: 35%;">‡§µ‡§ø‡§µ‡§∞‡§£</th>
                        <th style="width: 65%;">‡§Æ‡§æ‡§®</th>
                    </tr>
                </thead>
                <tbody id="pdfDetailsTable">
                    <!-- Content will be dynamically inserted here -->
                </tbody>
            </table>
            <div class="pdf-footer">
                <p>‡§Ø‡§π ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏ ‡§™‡§∞ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>
                <p class="mt-1">‡§™‡•ã‡§∞‡•ç‡§ü‡§≤: allinone.mp.gov.in | ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ: 8435273042</p>
                <p class="mt-2">‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§§‡§ø‡§•‡§ø: <span id="pdfDownloadDate"></span></p>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-gray-900 text-gray-300 py-8 px-4 mt-auto">
        <div class="container mx-auto text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="https://www.facebook.com/allin1mp" class="hover:text-white transition flex items-center">
                    <i class="fab fa-facebook-f mr-2"></i> Facebook
                </a>
                <a href="https://www.x.com/allin1mp" class="hover:text-white transition flex items-center">
                    <i class="fab fa-twitter mr-2"></i> Twitter
                </a>
                <a href="https://www.youtube.com/allin1mp" class="hover:text-white transition flex items-center">
                    <i class="fab fa-youtube mr-2"></i> YouTube
                </a>
                <a href="https://www.harshtiwari.in" class="hover:text-white transition flex items-center">
                    <i class="fas fa-globe mr-2"></i> ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü
                </a>
            </div>
            <p class="font-medium">¬© 2026 AllInOne MP | ‡§∏‡§≠‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§</p>
            <p class="text-xs mt-2 text-gray-400">ALLINONEMP - ‡§è‡§ï ‡§µ‡§ø‡§Ç‡§°‡•ã ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</p>
            <div class="mt-4 flex justify-center space-x-4">
                <span class="bg-blue-900 text-white text-xs px-4 py-1.5 rounded-full font-medium">
                    <i class="fas fa-shield-alt mr-1"></i> ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§
                </span>
                <span class="bg-green-800 text-white text-xs px-4 py-1.5 rounded-full font-medium">
                    <i class="fas fa-certificate mr-1"></i> ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§
                </span>
                <span class="bg-purple-800 text-white text-xs px-4 py-1.5 rounded-full font-medium">
                    <i class="fas fa-bolt mr-1"></i> ‡§â‡§ö‡•ç‡§ö ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®
                </span>
            </div>
        </div>
    </footer>

    <script type="module">
        /* ===== IMPORTS ===== */
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy }
        from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut }
        from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        /* ===== CONFIG ===== */
        const firebaseConfig = {
            apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
            authDomain: "allinone-aa89.firebaseapp.com",
            projectId: "allinone-aa89"
        };

        /* ===== INIT ===== */
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let currentUser = null;

        /* ===== AUTH GUARD - Enhanced Security ===== */
        onAuthStateChanged(auth, user => {
            if (!user) {
                // Not authenticated - redirect to login
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminToken');
                localStorage.removeItem('loginTime');
                localStorage.removeItem('adminEmail');
                localStorage.removeItem('adminName');
                
                if (!window.location.href.includes('adminlogin.html')) {
                    window.location.href = 'https://allinonemp.harshtiwari.in/adminlogin.html';
                }
            } else {
                // Authenticated
                currentUser = user;
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminToken', user.accessToken);
                localStorage.setItem('loginTime', new Date().getTime());
                localStorage.setItem('adminEmail', user.email || 'allinoneofficial@gmail.com');
                localStorage.setItem('adminName', user.displayName || 'Admin');
                
                document.getElementById('adminName').textContent = user.displayName || 'Admin';
                document.getElementById('adminEmail').textContent = user.email || 'allinoneofficial@gmail.com';
                document.getElementById('sidebarAdminName').textContent = user.displayName || 'Admin';
                
                loadData();
                setupEventListeners();
                initializeCharts();
            }
        });

        /* ===== DATA ===== */
        let allApplications = [];
        let currentFilters = {
            search: '',
            service: '',
            status: '',
            dateFrom: '',
            dateTo: ''
        };

        /* ===== QR CODE GENERATION ===== */
        function generateQRImage(text, size = 120) {
            return new Promise((resolve) => {
                try {
                    const qrContainer = document.createElement('div');
                    qrContainer.style.position = 'fixed';
                    qrContainer.style.left = '-9999px';
                    qrContainer.style.top = '0';
                    qrContainer.style.width = `${size}px`;
                    qrContainer.style.height = `${size}px`;
                    document.body.appendChild(qrContainer);
                    
                    const qr = new QRCode(qrContainer, {
                        text: text,
                        width: size,
                        height: size,
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    
                    setTimeout(() => {
                        const canvas = qrContainer.querySelector('canvas');
                        if (canvas) {
                            const clonedCanvas = document.createElement('canvas');
                            clonedCanvas.width = size;
                            clonedCanvas.height = size;
                            const ctx = clonedCanvas.getContext('2d');
                            ctx.drawImage(canvas, 0, 0, size, size);
                            const imgData = clonedCanvas.toDataURL('image/png');
                            document.body.removeChild(qrContainer);
                            resolve(imgData);
                        } else {
                            document.body.removeChild(qrContainer);
                            resolve(null);
                        }
                    }, 400);
                } catch (error) {
                    console.error("QR Generation Error:", error);
                    resolve(null);
                }
            });
        }

        /* ===== SETUP EVENT LISTENERS ===== */
        function setupEventListeners() {
            // Profile Dropdown
            document.getElementById('profileButton').addEventListener('click', () => {
                const dropdown = document.getElementById('profileDropdown');
                dropdown.classList.toggle('hidden');
            });

            // Notification Dropdown
            document.getElementById('notificationBtn').addEventListener('click', () => {
                const dropdown = document.getElementById('notificationDropdown');
                dropdown.classList.toggle('hidden');
            });

            // Close dropdowns on outside click
            document.addEventListener('click', (e) => {
                const profileDropdown = document.getElementById('profileDropdown');
                const profileButton = document.getElementById('profileButton');
                const notificationDropdown = document.getElementById('notificationDropdown');
                const notificationButton = document.getElementById('notificationBtn');
                
                if (!profileDropdown.contains(e.target) && !profileButton.contains(e.target)) {
                    profileDropdown.classList.add('hidden');
                }
                if (!notificationDropdown.contains(e.target) && !notificationButton.contains(e.target)) {
                    notificationDropdown.classList.add('hidden');
                }
            });

            // Search Filter
            document.getElementById('searchInput').addEventListener('input', (e) => {
                currentFilters.search = e.target.value.toLowerCase();
                applyFilters();
            });

            // Service Filter
            document.getElementById('serviceFilter').addEventListener('change', (e) => {
                currentFilters.service = e.target.value;
                applyFilters();
            });

            // Status Filter
            document.getElementById('statusFilter').addEventListener('change', (e) => {
                currentFilters.status = e.target.value;
                applyFilters();
            });

            // Date Filters
            document.getElementById('dateFrom').addEventListener('change', (e) => {
                currentFilters.dateFrom = e.target.value;
                applyFilters();
            });

            document.getElementById('dateTo').addEventListener('change', (e) => {
                currentFilters.dateTo = e.target.value;
                applyFilters();
            });

            // Clear Filters
            document.getElementById('clearFilters').addEventListener('click', () => {
                document.getElementById('searchInput').value = '';
                document.getElementById('serviceFilter').value = '';
                document.getElementById('statusFilter').value = '';
                document.getElementById('dateFrom').value = '';
                document.getElementById('dateTo').value = '';
                currentFilters = { search: '', service: '', status: '', dateFrom: '', dateTo: '' };
                render(allApplications);
                updateStats(allApplications);
            });

            // Reset Filters from empty state
            document.getElementById('resetFilters').addEventListener('click', () => {
                document.getElementById('searchInput').value = '';
                document.getElementById('serviceFilter').value = '';
                document.getElementById('statusFilter').value = '';
                currentFilters.search = '';
                currentFilters.service = '';
                currentFilters.status = '';
                render(allApplications);
                updateStats(allApplications);
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('dataTable').classList.remove('hidden');
            });

            // Export CSV
            document.getElementById('exportCSV').addEventListener('click', exportToCSV);

            // Export Excel
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);

            // Print View
            document.getElementById('printView').addEventListener('click', () => {
                printApplication();
            });

            // Sidebar Toggle
            document.getElementById('sidebarToggle').addEventListener('click', () => {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('sidebar-collapsed');
                document.getElementById('sidebarToggle').innerHTML = sidebar.classList.contains('collapsed') ? 
                    '<i class="fas fa-chevron-right"></i>' : '<i class="fas fa-chevron-left"></i>';
            });
        }

        /* ===== LOAD DATA ===== */
        function loadData() {
            listen("applications");
            listen("samagra_ekyc_requests");
            listen("mpbhojApplications");
        }

        function listen(col) {
            const q = query(collection(db, col), orderBy('createdAt', 'desc'));
            onSnapshot(q, snap => {
                allApplications = allApplications.filter(i => i._collection !== col);
                const data = snap.docs.map(d => ({
                    id: d.id,
                    _collection: col,
                    ...d.data()
                }));
                allApplications = [...allApplications, ...data].sort((a, b) => 
                    (b.createdAt?.toDate?.() || new Date()) - (a.createdAt?.toDate?.() || new Date())
                );
                render(allApplications);
                updateStats(allApplications);
                updateCharts();
            }, error => {
                console.error("Error loading  ", error);
                document.getElementById('dataTable').innerHTML = `
                    <tr>
                        <td colspan="7" class="p-8 text-center">
                            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-3"></i>
                            <p class="mt-3 text-red-600 font-medium text-lg">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</p>
                            <p class="text-gray-500 mt-2">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        </td>
                    </tr>
                `;
            });
        }

        /* ===== APPLY FILTERS ===== */
        function applyFilters() {
            let filteredData = [...allApplications];
            
            if (currentFilters.search) {
                filteredData = filteredData.filter(app => {
                    const name = (app.studentName || app.applicantName || '').toLowerCase();
                    const id = (app.memberId || '').toLowerCase();
                    return name.includes(currentFilters.search) || id.includes(currentFilters.search);
                });
            }
            
            if (currentFilters.service) {
                filteredData = filteredData.filter(app => {
                    const service = getServiceName(app).toLowerCase();
                    return service.includes(currentFilters.service);
                });
            }
            
            if (currentFilters.status) {
                filteredData = filteredData.filter(app => app.status === currentFilters.status);
            }
            
            if (currentFilters.dateFrom || currentFilters.dateTo) {
                filteredData = filteredData.filter(app => {
                    if (!app.createdAt) return false;
                    const appDate = new Date(app.createdAt.toDate());
                    const fromDate = currentFilters.dateFrom ? new Date(currentFilters.dateFrom) : null;
                    const toDate = currentFilters.dateTo ? new Date(currentFilters.dateTo) : null;
                    if (fromDate && appDate < fromDate) return false;
                    if (toDate && appDate > toDate) return false;
                    return true;
                });
            }
            
            render(filteredData);
            updateStats(filteredData);
            updateCharts(filteredData);
        }

        /* ===== RENDER TABLE ===== */
        function render(data) {
            const tableBody = document.getElementById("dataTable");
            const emptyState = document.getElementById("emptyState");
            document.getElementById("totalApplications").textContent = allApplications.length;
            
            if (data.length === 0) {
                tableBody.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            } else {
                tableBody.classList.remove('hidden');
                emptyState.classList.add('hidden');
            }
            
            let rows = '';
            data.slice(0, 50).forEach((i, index) => {
                const appNo = `AIO-${i.id.substring(0, 8).toUpperCase()}`;
                const serviceName = getServiceName(i);
                const statusClass = i.status === 'complete' ? 'status-complete' :
                    i.status === 'reject' ? 'status-reject' : 
                    i.status === 'processing' ? 'status-processing' : 'status-pending';
                const statusText = i.status === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' :
                    i.status === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : 
                    i.status === 'processing' ? '‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó' : '‡§≤‡§Ç‡§¨‡§ø‡§§';
                
                rows += `
                    <tr class="table-row border-b border-gray-100">
                        <td class="p-4 font-mono font-medium text-blue-700">${appNo}</td>
                        <td class="p-4 font-bold text-gray-800">${i.studentName || i.applicantName || "-"}</td>
                        <td class="p-4">
                            <span class="px-3 py-1.5 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">${serviceName}</span>
                        </td>
                        <td class="p-4 hidden md:table-cell font-mono">${i.memberId || "-"}</td>
                        <td class="p-4 hidden sm:table-cell">${formatDate(i.createdAt)}</td>
                        <td class="p-4">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </td>
                        <td class="p-4">
                            <div class="flex space-x-2">
                                <button onclick="openDetails('${i.id}')" class="action-btn action-view" title="‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="del('${i.id}')" class="action-btn action-delete" title="‡§π‡§ü‡§æ‡§è‡§Ç">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = rows;
        }

        /* ===== UPDATE STATS ===== */
        function updateStats(data) {
            document.getElementById('statTotal').textContent = data.length;
            const pending = data.filter(a => a.status === 'pending').length;
            const complete = data.filter(a => a.status === 'complete').length;
            const rejected = data.filter(a => a.status === 'reject').length;
            const processing = data.filter(a => a.status === 'processing').length;
            
            document.getElementById('statPending').textContent = pending;
            document.getElementById('statComplete').textContent = complete;
            document.getElementById('statRejected').textContent = rejected;
            
            // Growth calculations
            document.getElementById('statTotalGrowth').textContent = '+12%';
            document.getElementById('statPendingCount').textContent = pending;
            document.getElementById('statCompleteRate').textContent = data.length > 0 ? Math.round((complete / data.length) * 100) + '%' : '0%';
            document.getElementById('statRejectionRate').textContent = data.length > 0 ? Math.round((rejected / data.length) * 100) + '%' : '0%';
        }

        /* ===== CHARTS INITIALIZATION ===== */
        let applicationsChart, servicesChart;

        function initializeCharts() {
            const ctx1 = document.getElementById('applicationsChart').getContext('2d');
            applicationsChart = new Chart(ctx1, {
                type: 'line',
                 {
                    labels: ['‡§ú‡§®', '‡§´‡§∞', '‡§Æ‡§æ‡§∞‡•ç‡§ö', '‡§Ö‡§™‡•ç‡§∞‡•à', '‡§Æ‡§à', '‡§ú‡•Ç‡§®'],
                    datasets: [{
                        label: '‡§Ü‡§µ‡•á‡§¶‡§®',
                         [65, 59, 80, 81, 56, 55],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            const ctx2 = document.getElementById('servicesChart').getContext('2d');
            servicesChart = new Chart(ctx2, {
                type: 'doughnut',
                 {
                    labels: ['‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä', '‡§à-‡§ï‡•á‡§µ‡§æ‡§à‡§∏‡•Ä', '‡§è‡§Æ‡§™‡•Ä ‡§≠‡•ã‡§ú', '‡§õ‡§æ‡§§‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø', '‡§™‡•á‡§Ç‡§∂‡§®'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#8b5cf6',
                            '#ef4444'
                        ],
                        borderWidth: 0,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function updateCharts(filteredData = null) {
            const data = filteredData || allApplications;
            
            // Update applications chart with real data
            const monthlyData = [0, 0, 0, 0, 0, 0];
            data.forEach(app => {
                if (app.createdAt) {
                    const month = app.createdAt.toDate().getMonth();
                    if (month >= 0 && month <= 5) {
                        monthlyData[month]++;
                    }
                }
            });
            
            if (applicationsChart) {
                applicationsChart.data.datasets[0].data = monthlyData;
                applicationsChart.update();
            }
            
            // Update services chart
            const serviceCounts = {
                'samagra': 0,
                'ekyc': 0,
                'mpbhoj': 0,
                'scholarship': 0,
                'pension': 0
            };
            
            data.forEach(app => {
                const service = getServiceName(app).toLowerCase();
                if (service.includes('samagra')) serviceCounts.samagra++;
                else if (service.includes('ekyc')) serviceCounts.ekyc++;
                else if (service.includes('mpbhoj') || service.includes('‡§≠‡•ã‡§ú')) serviceCounts.mpbhoj++;
                else if (service.includes('scholarship') || service.includes('‡§õ‡§æ‡§§‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø')) serviceCounts.scholarship++;
                else if (service.includes('pension') || service.includes('‡§™‡•á‡§Ç‡§∂‡§®')) serviceCounts.pension++;
            });
            
            if (servicesChart) {
                servicesChart.data.datasets[0].data = [
                    serviceCounts.samagra,
                    serviceCounts.ekyc,
                    serviceCounts.mpbhoj,
                    serviceCounts.scholarship,
                    serviceCounts.pension
                ];
                servicesChart.update();
            }
        }

        /* ===== HELPERS ===== */
        function getServiceName(app) {
            return app.serviceType || app.formType || app.serviceName || app.service || app.applicationType || '‡§Ö‡§®‡•ç‡§Ø';
        }

        function formatDate(ts) {
            if (!ts) return "-";
            return ts.toDate().toLocaleDateString("hi-IN", {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        function formatLabel(key) {
            return key
                .replace(/_/g, " ")
                .replace(/([A-Z])/g, " $1")
                .replace(/^./, s => s.toUpperCase())
                .replace('Id', 'ID');
        }

        /* ===== ACTIONS ===== */
        window.del = async (id) => {
            if (!confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§π ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä‡•§")) {
                return;
            }
            const item = allApplications.find(x => x.id === id);
            if (!item) return;
            try {
                await deleteDoc(doc(db, item._collection, id));
                alert("‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!");
            } catch (error) {
                console.error("Error deleting document: ", error);
                alert("‡§Ü‡§µ‡•á‡§¶‡§® ‡§π‡§ü‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
            }
        };

        window.updateStatus = async (status) => {
            const appNoElement = document.getElementById('modalApplicationNo');
            if (!appNoElement) return;
            const appNo = appNoElement.textContent;
            const item = allApplications.find(x => appNo.includes(x.id.substring(0,8).toUpperCase()));
            if (!item) {
                alert("‡§Ü‡§µ‡•á‡§¶‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§");
                return;
            }
            try {
                await updateDoc(doc(db, item._collection, item.id), { status });
                closeDetails();
                const statusText = status === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' : 
                    status === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : '‡§≤‡§Ç‡§¨‡§ø‡§§';
                alert(`‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø "${statusText}" ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡•§`);
                loadData(); // Refresh data
            } catch (error) {
                console.error("Error updating status: ", error);
                alert("‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
            }
        };

        window.logout = () => {
            if (confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
                signOut(auth).then(() => {
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('loginTime');
                    localStorage.removeItem('adminEmail');
                    localStorage.removeItem('adminName');
                    window.location.href = 'https://allinonemp.harshtiwari.in/adminlogin.html';
                }).catch((error) => {
                    console.error("Logout error:", error);
                    alert("‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
                });
            }
        };

        /* ===== DETAILS MODAL ===== */
        window.openDetails = (id) => {
            const item = allApplications.find(a => a.id === id);
            if (!item) return;
            const appNo = `AIO-${item.id.substring(0,8).toUpperCase()}`;
            const appNoElement = document.getElementById("modalApplicationNo");
            appNoElement.textContent = appNo;
            appNoElement.dataset.appId = item.id;
            const detailBody = document.getElementById("detailBody");
            let detailsHTML = '';
            const personalInfo = ['applicantName', 'studentName', 'fatherName', 'motherName', 'dob', 'gender', 'mobileNumber', 'email', 'aadhaarNumber'];
            const addressInfo = ['address', 'village', 'tehsil', 'district', 'pincode', 'state'];
            const applicationInfo = ['memberId', 'applicationType', 'serviceType', 'formType', 'serviceName', 'status', 'createdAt', 'updatedAt'];
            
            detailsHTML += `<div class="col-span-full"><h3 class="font-bold text-lg text-blue-800 mb-3 pb-2 border-b border-blue-100 flex items-center"><i class="fas fa-user mr-2"></i> ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h3></div>`;
            personalInfo.forEach(key => {
                if (item.hasOwnProperty(key) && item[key]) {
                    detailsHTML += createDetailRow(key, item[key]);
                }
            });
            
            detailsHTML += `<div class="col-span-full"><h3 class="font-bold text-lg text-blue-800 mt-4 mb-3 pb-2 border-b border-blue-100 flex items-center"><i class="fas fa-map-marker-alt mr-2"></i> ‡§™‡§§‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h3></div>`;
            addressInfo.forEach(key => {
                if (item.hasOwnProperty(key) && item[key]) {
                    detailsHTML += createDetailRow(key, item[key]);
                }
            });
            
            detailsHTML += `<div class="col-span-full"><h3 class="font-bold text-lg text-blue-800 mt-4 mb-3 pb-2 border-b border-blue-100 flex items-center"><i class="fas fa-file-alt mr-2"></i> ‡§Ü‡§µ‡•á‡§¶‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</h3></div>`;
            applicationInfo.forEach(key => {
                if (item.hasOwnProperty(key) && item[key]) {
                    let value = item[key];
                    if (key === 'createdAt' && value) {
                        value = formatDate(value);
                    }
                    if (key === 'updatedAt' && value) {
                        value = formatDate(value);
                    }
                    if (key === 'status') {
                        const statusClass = value === 'complete' ? 'status-complete' :
                            value === 'reject' ? 'status-reject' : 'status-pending';
                        const statusText = value === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' :
                            value === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : '‡§≤‡§Ç‡§¨‡§ø‡§§';
                        value = `<span class="status-badge ${statusClass}">${statusText}</span>`;
                    }
                    detailsHTML += createDetailRow(key, value);
                }
            });
            
            detailBody.innerHTML = detailsHTML;
            document.getElementById("detailModal").classList.remove("hidden");
            document.getElementById("detailModal").classList.add("flex");
            preparePDFContent(item, appNo);
        };

        function createDetailRow(key, value) {
            return `
                <div class="bg-blue-50 p-3.5 rounded-lg border border-blue-100">
                    <div class="text-xs text-blue-700 font-medium flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        ${formatLabel(key)}
                    </div>
                    <div class="font-semibold text-gray-800 mt-1.5">${value || "-"}</div>
                </div>
            `;
        }

        window.closeDetails = () => {
            document.getElementById("detailModal").classList.add("hidden");
        };

        /* ===== PDF CONTENT PREPARATION ===== */
        function preparePDFContent(item, appNo) {
            try {
                const originalAppNo = `AIO-${item.id.substring(0,8).toUpperCase()}`;
                document.getElementById("pdfApplicationNo").textContent = originalAppNo;
                const today = new Date().toLocaleDateString("hi-IN", {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                document.getElementById("pdfDownloadDate").textContent = today;
                const qrContainer = document.getElementById("pdfQR");
                if (qrContainer) {
                    qrContainer.innerHTML = "";
                }
                const pdfTableBody = document.getElementById("pdfDetailsTable");
                if (!pdfTableBody) return originalAppNo;
                let tableRows = '';
                const fieldOrder = [
                    'applicantName', 'studentName', 'fatherName', 'motherName',
                    'dob', 'gender', 'mobileNumber', 'email', 'aadhaarNumber',
                    'address', 'village', 'tehsil', 'district', 'pincode', 'state',
                    'memberId', 'applicationType', 'serviceType', 'formType',
                    'serviceName', 'status', 'createdAt', 'updatedAt'
                ];
                fieldOrder.forEach(key => {
                    if (item.hasOwnProperty(key) && item[key] !== null && item[key] !== undefined) {
                        let displayValue = item[key];
                        let displayKey = formatLabel(key);
                        if ((key === 'createdAt' || key === 'updatedAt') && item[key]?.toDate) {
                            displayValue = item[key].toDate().toLocaleDateString("hi-IN", {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }
                        if (key === 'status') {
                            displayValue = item[key] === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' :
                                item[key] === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : '‡§≤‡§Ç‡§¨‡§ø‡§§';
                        }
                        if (key === 'gender') {
                            displayValue = item[key] === 'male' ? '‡§™‡•Å‡§∞‡•Å‡§∑' :
                                item[key] === 'female' ? '‡§Æ‡§π‡§ø‡§≤‡§æ' :
                                item[key] === 'other' ? '‡§Ö‡§®‡•ç‡§Ø' : item[key];
                        }
                        tableRows += `
                            <tr>
                                <td style="font-weight: bold; background-color: #f8fafc; padding: 12px 15px; border: 1px solid #cbd5e1 !important;">${displayKey}</td>
                                <td style="padding: 12px 15px; border: 1px solid #cbd5e1 !important;">${displayValue || "-"}</td>
                            </tr>
                        `;
                    }
                });
                Object.keys(item).forEach(key => {
                    if (!fieldOrder.includes(key) &&
                        !['_collection', 'id', '__v'].includes(key) &&
                        item[key] !== null &&
                        item[key] !== undefined) {
                        let displayValue = item[key];
                        let displayKey = formatLabel(key);
                        if ((key === 'createdAt' || key === 'updatedAt') && item[key]?.toDate) {
                            displayValue = item[key].toDate().toLocaleDateString("hi-IN", {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric'
                            });
                        }
                        tableRows += `
                            <tr>
                                <td style="font-weight: bold; background-color: #f8fafc; padding: 12px 15px; border: 1px solid #cbd5e1 !important;">${displayKey}</td>
                                <td style="padding: 12px 15px; border: 1px solid #cbd5e1 !important;">${displayValue || "-"}</td>
                            </tr>
                        `;
                    }
                });
                pdfTableBody.innerHTML = tableRows;
                return originalAppNo;
            } catch (error) {
                console.error("Error preparing PDF content:", error);
                return appNo || 'AIO-UNKNOWN';
            }
        }

        /* ===== PDF DOWNLOAD ===== */
        window.downloadPDF = async () => {
            const appNoElement = document.getElementById("modalApplicationNo");
            const currentAppId = appNoElement.dataset?.appId || '';
            const currentItem = allApplications.find(a => a.id === currentAppId);
            if (!currentItem) {
                alert("‡§Ü‡§µ‡•á‡§¶‡§® ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§");
                return;
            }
            const originalBtnText = appNoElement.textContent;
            appNoElement.textContent = "PDF ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
            try {
                const pdfContent = document.getElementById("pdfContent");
                const pdfPage = pdfContent.querySelector('.pdf-page');
                pdfContent.style.width = '794px';
                pdfContent.style.height = '1123px';
                pdfContent.style.position = 'fixed';
                pdfContent.style.top = '0';
                pdfContent.style.left = '0';
                pdfContent.style.visibility = 'visible';
                pdfContent.style.opacity = '1';
                pdfContent.style.zIndex = '9999';
                pdfContent.style.pointerEvents = "none";
                pdfPage.style.width = '794px';
                pdfPage.style.minHeight = '1123px';
                pdfPage.style.padding = '95px';
                const originalAppNo = preparePDFContent(currentItem, `AIO-${currentItem.id.substring(0,8).toUpperCase()}`);
                const qrData = `Application: ${originalAppNo}\nName: ${currentItem.applicantName || currentItem.studentName || ""}\nService: ${getServiceName(currentItem)}`;
                const qrImage = await generateQRImage(qrData, 120);
                const qrContainer = document.getElementById('pdfQR');
                qrContainer.innerHTML = '';
                if (qrImage) {
                    qrContainer.innerHTML = `<img src="${qrImage}" width="120" height="120" style="width:100%;height:100%;display:block;">`;
                } else {
                    qrContainer.innerHTML = `<div style="width:120px;height:120px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;text-align:center;font-size:10px;color:#64748b;line-height:1.4;">QR ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</div>`;
                }
                await document.fonts.ready;
                await new Promise(resolve => setTimeout(resolve, 600));
                const element = document.getElementById("pdfContent");
                const opt = {
                    margin: 0,
                    filename: `AllInOneMP_${originalAppNo.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: {
                        scale: 2,
                        useCORS: true,
                        letterRendering: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                        width: 794,
                        height: 1123,
                        windowWidth: 794,
                        windowHeight: 1123,
                        scrollY: -window.scrollY,
                        removeContainer: true,
                        foreignObjectRendering: false
                    },
                    jsPDF: {
                        unit: 'mm',
                        format: 'a4',
                        orientation: 'portrait',
                        compress: true
                    }
                };
                await html2pdf().set(opt).from(element).save();
                alert(`‚úÖ PDF ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•Å‡§Ü!\n‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${originalAppNo}`);
            } catch (error) {
                console.error("PDF Generation Error:", error);
                alert("PDF ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§\n‡§ï‡•É‡§™‡§Ø‡§æ Chrome ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
            } finally {
                const pdfContent = document.getElementById("pdfContent");
                pdfContent.style.position = 'fixed';
                pdfContent.style.left = '0';
                pdfContent.style.top = '0';
                pdfContent.style.visibility = 'hidden';
                pdfContent.style.opacity = '1';
                pdfContent.style.width = '794px';
                pdfContent.style.height = '1123px';
                appNoElement.textContent = originalBtnText;
            }
        };

        window.printApplication = () => {
            const pdfContent = document.getElementById("pdfContent");
            pdfContent.style.visibility = 'visible';
            pdfContent.style.position = 'fixed';
            pdfContent.style.left = '0';
            pdfContent.style.top = '0';
            const appNoElement = document.getElementById("modalApplicationNo");
            const currentAppId = appNoElement.dataset?.appId || '';
            const currentItem = allApplications.find(a => a.id === currentAppId);
            if (currentItem) {
                preparePDFContent(currentItem);
                const qrData = `Application: AIO-${currentItem.id.substring(0,8).toUpperCase()}\nName: ${currentItem.applicantName || currentItem.studentName || ""}\nService: ${getServiceName(currentItem)}`;
                generateQRImage(qrData, 120).then(qrImage => {
                    if (qrImage) {
                        document.getElementById('pdfQR').innerHTML = `<img src="${qrImage}" width="120" height="120" style="display:block;">`;
                    }
                    setTimeout(() => {
                        window.print();
                        pdfContent.style.visibility = 'hidden';
                    }, 300);
                });
            } else {
                window.print();
                pdfContent.style.visibility = 'hidden';
            }
        };

        /* ===== EXPORT FUNCTIONS ===== */
        function exportToCSV() {
            let data = [...allApplications];
            if (currentFilters.search) {
                data = data.filter(app => {
                    const name = (app.studentName || app.applicantName || '').toLowerCase();
                    const id = (app.memberId || '').toLowerCase();
                    return name.includes(currentFilters.search) || id.includes(currentFilters.search);
                });
            }
            if (currentFilters.service) {
                data = data.filter(app => {
                    const service = getServiceName(app).toLowerCase();
                    return service.includes(currentFilters.service);
                });
            }
            if (currentFilters.status) {
                data = data.filter(app => app.status === currentFilters.status);
            }
            if (data.length === 0) {
                alert("‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§");
                return;
            }
            const headers = ['‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï', '‡§®‡§æ‡§Æ', '‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞', '‡§∏‡§Æ‡§ó‡•ç‡§∞ ID', '‡§§‡§æ‡§∞‡•Ä‡§ñ', '‡§∏‡•ç‡§•‡§ø‡§§‡§ø', '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞', '‡§à‡§Æ‡•á‡§≤'];
            let csvContent = '\uFEFF' + headers.join(',') + '\n';
            data.forEach(app => {
                const appNo = `AIO-${app.id.substring(0, 8).toUpperCase()}`;
                const row = [
                    appNo,
                    app.studentName || app.applicantName || '-',
                    getServiceName(app),
                    app.memberId || '-',
                    app.createdAt ? formatDate(app.createdAt) : '-',
                    app.status === 'complete' ? '‡§™‡•Ç‡§∞‡•ç‡§£' : app.status === 'reject' ? '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : '‡§≤‡§Ç‡§¨‡§ø‡§§',
                    app.mobileNumber || '-',
                    app.email || '-'
                ].map(field => `"${field}"`).join(',');
                csvContent += row + '\n';
            });
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `AllInOneMP_Applications_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToExcel() {
            alert("Excel export feature will be available in the next update!");
        }

        /* ===== INITIALIZATION ===== */
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('emptyState').classList.add('hidden');
        });
    </script>
</body>
</html>
