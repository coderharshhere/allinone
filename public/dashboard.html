/* ===== EXPORT TO CSV ===== */
function exportToCSV() {
let data = [...allApplications];
if (currentFilters.search) {
data = data.filter(app => {
const name = (app.studentName || app.applicantName || '').toLowerCase();
const id = (app.memberId || '').toLowerCase();
return name.includes(currentFilters.search) || id.includes(currentFilters.search);
});
}
if (currentFilters.service) {
data = data.filter(app => {
const service = getServiceName(app).toLowerCase();
return service.includes(currentFilters.service);
});
}
if (currentFilters.status) {
data = data.filter(app => app.status === currentFilters.status);
}
if (data.length === 0) {
alert("निर्यात करने के लिए कोई डेटा नहीं है।");
return;
}
const headers = ['आवेदन क्रमांक', 'नाम', 'सेवा प्रकार', 'समग्र ID', 'तारीख', 'स्थिति', 'मोबाइल नंबर', 'ईमेल'];
let csvContent = '\uFEFF' + headers.join(',') + '\n';
data.forEach(app => {
const appNo = `AIO-${app.id.substring(0, 8).toUpperCase()}`;
const row = [
appNo,
app.studentName || app.applicantName || '-',
getServiceName(app),
app.memberId || '-',
app.createdAt ? formatDate(app.createdAt) : '-',
app.status === 'complete' ? 'पूर्ण' : app.status === 'reject' ? 'अस्वीकृत' : 'लंबित',
app.mobileNumber || '-',
app.email || '-'
].map(field => `"${field}"`).join(',');
csvContent += row + '\n';
});
const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
const link = document.createElement("a");
const url = URL.createObjectURL(blob);
link.setAttribute("href", url);
link.setAttribute("download", `AllInOneMP_Applications_${new Date().toISOString().split('T')[0]}.csv`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
}
document.addEventListener('DOMContentLoaded', () => {
document.getElementById('emptyState').classList.add('hidden');
// Preload Hindi font
const link = document.createElement('link');
link.href = 'https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap';
link.rel = 'stylesheet';
document.head.appendChild(link);
});
</script>
</body>
</html>
