<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AllInOne MP ‚Äì Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Font -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap');
    body { font-family: 'Noto Sans Devanagari', sans-serif; }
    .ticker-wrapper { overflow: hidden; background: #fffbeb; }
    .ticker-text {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: ticker 30s linear infinite;
    }
    @keyframes ticker {
      100% { transform: translateX(-100%); }
    }
  </style>
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">

<!-- ================= TOP BAR ================= -->
<div class="bg-blue-900 text-white text-xs py-2 px-4 flex justify-between items-center">
  <div>‡§Æ‡§ß‡•ç‡§Ø‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§∏‡§∞‡§ï‡§æ‡§∞ | Government of Madhya Pradesh</div>
  <div class="flex gap-4">
    <a href="#" class="hover:underline">Screen Reader Access</a>
    <span>A- | A | A+</span>
  </div>
</div>

<!-- ================= HEADER ================= -->
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Emblem_of_Madhya_Pradesh.svg/1200px-Emblem_of_Madhya_Pradesh.svg.png"
           class="h-14" alt="MP">
      <div>
        <h1 class="text-2xl font-bold text-blue-900">AllInOne MP</h1>
        <p class="text-sm text-gray-600">one window service portal</p>
      </div>
    </div>

    <div class="hidden md:flex gap-6 items-center">
      <div class="text-right">
        <p class="text-xs text-gray-500 uppercase">‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞</p>
        <p class="font-bold text-blue-800">
          <a href="https://wa.me/918435273042" target="_blank">8435273042</a>
        </p>
      </div>

      <!-- LOGOUT -->
      <button onclick="logout()"
        class="bg-red-600 text-white px-6 py-2 rounded-full font-bold hover:bg-red-700">
        ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü
      </button>
    </div>
  </div>
</header>

<!-- ================= NAV ================= -->
<nav class="bg-blue-800 text-white">
  <div class="container mx-auto px-4">
    <ul class="flex overflow-x-auto whitespace-nowrap py-3 gap-8">
      <li><a href="index.html" class="hover:text-blue-200 flex gap-2">
        <i class="fas fa-home"></i> ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§†</a></li>
      <li><a href="#" class="hover:text-blue-200">‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§∏‡•á‡§µ‡§æ‡§è‡§Å</a></li>
      <li><a href="#" class="hover:text-blue-200">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å</a></li>
      <li><a href="dashboard.html" class="hover:text-blue-200">‡§µ‡§ø‡§≠‡§æ‡§ó‡•Ä‡§Ø ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</a></li>
      <li><a href="#" class="hover:text-blue-200">‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§®‡§ø‡§µ‡§æ‡§∞‡§£</a></li>
    </ul>
  </div>
</nav>

<!-- ================= TICKER ================= -->
<div class="ticker-wrapper py-2">
  <div class="ticker-text text-sm text-red-600 font-bold">
    üì¢ ‡§∏‡•Ç‡§ö‡§®‡§æ: ‡§≤‡§æ‡§°‡§º‡§≤‡•Ä ‡§¨‡§π‡§®‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ó‡§§ ‡§ï‡•á‡§µ‡§æ‡§à‡§∏‡•Ä ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø |
    ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§∏‡•Ä‡§ñ‡•ã-‡§ï‡§Æ‡§æ‡§ì ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ |
    ‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§ß‡§æ‡§∞ ‡§≤‡§ø‡§Ç‡§ï ‡§®‡§ø‡§É‡§∂‡•Å‡§≤‡•ç‡§ï
  </div>
</div>

<!-- ================= MAIN ================= -->
<main class="flex-grow container mx-auto px-4 py-10">

  <h2 class="text-2xl font-bold text-gray-800 mb-6">
    üìã ‡§Ü‡§µ‡•á‡§¶‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°
  </h2>

  <!-- FILTER TABS -->
  <div class="flex gap-3 mb-6">
    <button class="px-4 py-2 bg-gray-200 rounded">‡§∏‡§≠‡•Ä</button>
    <button class="px-4 py-2 bg-blue-200 rounded">‡§∏‡§Æ‡§ó‡•ç‡§∞</button>
    <button class="px-4 py-2 bg-green-200 rounded">‡§®‡§ø‡§µ‡§æ‡§∏</button>
    <button class="px-4 py-2 bg-yellow-200 rounded">‡§ú‡§æ‡§§‡§ø</button>
  </div>

  <!-- TABLE -->
  <div class="bg-white rounded-xl shadow overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-blue-800 text-white">
        <tr>
          <th class="px-4 py-3">‡§®‡§æ‡§Æ</th>
          <th class="px-4 py-3">‡§∏‡•á‡§µ‡§æ</th>
          <th class="px-4 py-3">‡§∏‡§Æ‡§ó‡•ç‡§∞ ID</th>
          <th class="px-4 py-3">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
        </tr>
      </thead>
      <tbody id="dataTable" class="divide-y">
        <!-- Firebase Data -->
      </tbody>
    </table>
  </div>

</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-gray-900 text-gray-400 py-12 px-4">
  <div class="container mx-auto text-center">
    <p>¬© 2026 AllInOne | MP Govt Services Portal</p>
    <p class="text-xs mt-2">Managed by IT Department, Madhya Pradesh</p>
  </div>
</footer>
  <!-- ================= DETAIL MODAL ================= -->
<div id="detailModal"
     class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">

  <div class="bg-white w-full max-w-3xl rounded-xl shadow-xl overflow-y-auto max-h-[90vh]">
    
    <div class="bg-blue-800 text-white px-6 py-4 flex justify-between items-center">
      <h3 class="font-bold text-lg">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
      <button onclick="closeDetails()" class="text-xl font-bold">√ó</button>
    </div>

    <div id="detailBody" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <!-- data here -->
    </div>

  </div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { updateDoc, doc } from
"https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, getDocs }
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
window.changeStatus = async function (docId, newStatus) {
  try {
    await updateDoc(
      doc(db, "applications", docId),
      { status: newStatus }
    );

    console.log("Status updated:", newStatus);

  } catch (error) {
    console.error("Status update error:", error);
    alert("‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§¨‡§¶‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à");
  }
};

const firebaseConfig = {
  apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
  authDomain: "allinone-aa89.firebaseapp.com",
  projectId: "allinone-aa89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üîí Auth protect
onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "login.html";
  else loadData();
});

// üî¥ Logout
window.logout = () => {
  signOut(auth).then(() => {
    window.location.href = "login.html";
  });
};

// üì• Load Data
async function loadData() {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";

  const snap = await getDocs(collection(db, "applications"));
  snap.forEach(doc => {
    const d = doc.data();
    table.innerHTML += `
      <tr class="hover:bg-gray-50 cursor-pointer">
        <td class="px-4 py-3 font-bold text-blue-800 cursor-pointer underline"
    onclick="openDetails('${doc.id}')">
  ${d.applicantName || "-"}
</td>
        <td class="px-4 py-3">${d.serviceType || "-"}</td>
        <td class="px-4 py-3">${d.samagraId || "-"}</td>
<td class="px-4 py-3">
  <select
    class="border rounded px-2 py-1 text-sm font-bold
      ${d.status === 'complete' ? 'text-green-600' :
        d.status === 'reject' ? 'text-red-600' :
        'text-blue-600'}"
    onchange="changeStatus('${doc.id}', this.value)">
    
    <option value="pending" ${d.status === 'pending' ? 'selected' : ''}>
      pending
    </option>

    <option value="complete" ${d.status === 'complete' ? 'selected' : ''}>
      complete
    </option>

    <option value="reject" ${d.status === 'reject' ? 'selected' : ''}>
      reject
    </option>
  </select>
</td>
      </tr>`;
  });
}
  import { doc, getDoc } from
  "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

window.openDetails = async function(id) {
  const ref = doc(db, "applications", id);
  const snap = await getDoc(ref);

  if (!snap.exists()) return;

  const d = snap.data();
  document.getElementById("detailBody").innerHTML = `
    <div><b>‡§®‡§æ‡§Æ:</b> ${d.applicantName || "-"}</div>
    <div><b>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ:</b> ${d.fatherName || "-"}</div>
    <div><b>‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:</b> ${d.serviceType || "-"}</div>
    <div><b>‡§∏‡§Æ‡§ó‡•ç‡§∞ ID:</b> ${d.samagraId || "-"}</div>
    <div><b>‡§Ü‡§ß‡§æ‡§∞:</b> ${d.aadhaar || "-"}</div>
    <div><b>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</b> ${d.mobile || "-"}</div>
    <div><b>‡§Ü‡§Ø:</b> ‚Çπ ${d.annualIncome || "-"}</div>
    <div><b>‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</b> ${d.status || "PENDING"}</div>
    <div class="md:col-span-2"><b>‡§™‡§§‡§æ:</b> ${d.fullAddress || "-"}</div>
  `;

  document.getElementById("detailModal").classList.remove("hidden");
  document.getElementById("detailModal").classList.add("flex");
};

window.closeDetails = function() {
  document.getElementById("detailModal").classList.add("hidden");
};

</script>

</body>
</html>
