<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§Ü‡§Ø ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‚Äì ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<!-- HEADER -->
<div class="bg-blue-800 text-white px-6 py-4 flex justify-between items-center">
  <h1 class="text-xl font-bold"> ‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡•Ç‡§ö‡•Ä</h1>
  <button onclick="logout()" class="bg-red-600 px-4 py-2 rounded font-bold">Logout</button>
</div>

<!-- TABLE -->
<div class="p-6">
  <div class="bg-white rounded shadow overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-blue-700 text-white">
        <tr>
          <th class="px-4 py-3">‡§®‡§æ‡§Æ</th>
          <th class="px-4 py-3">‡§∏‡§Æ‡§ó‡•ç‡§∞ ID</th>
          <th class="px-4 py-3">‡§Ü‡§Ø</th>
          <th class="px-4 py-3">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
        </tr>
      </thead>
      <tbody id="applicationsTable"></tbody>
    </table>
  </div>
</div>

<!-- MODAL (DETAIL VIEW) -->
<div id="detailModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white w-full max-w-2xl rounded-lg p-6 relative">
    <button onclick="closeModal()" class="absolute top-2 right-3 text-xl font-bold">‚úñ</button>

    <h2 class="text-xl font-bold mb-4 text-blue-800">
      ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£
    </h2>

    <div id="detailContent" class="space-y-2 text-sm"></div>
  </div>
</div>

<!-- FIREBASE + LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  getDoc,
  query,
  where
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
  authDomain: "allinone-aa89.firebaseapp.com",
  projectId: "allinone-aa89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üîí Auth protection
onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "login.html";
});

// üî¥ Logout
window.logout = () => {
  signOut(auth).then(() => location.href = "login.html");
};

// üì• Load Income Certificate applications
const table = document.getElementById("applicationsTable");

const q = query(
  collection(db, "applications"),
  where("serviceType", "==", "Income Certificate")
);

const snapshot = await getDocs(q);

snapshot.forEach(d => {
  const data = d.data();
  table.innerHTML += `
    <tr class="border-b hover:bg-gray-50">
      <td class="px-4 py-3 text-blue-700 font-bold cursor-pointer"
          onclick="showDetails('${d.id}')">
        ${data.applicantName || "-"}
      </td>
      <td class="px-4 py-3">${data.samagraId || "-"}</td>
      <td class="px-4 py-3">‚Çπ ${data.annualIncome || "-"}</td>
      <td class="px-4 py-3 text-blue-600 font-bold">${data.status}</td>
    </tr>
  `;
});

// üîç Show full details
window.showDetails = async function (docId) {
  const ref = doc(db, "applications", docId);
  const snap = await getDoc(ref);

  if (!snap.exists()) return;

  const d = snap.data();
  const box = document.getElementById("detailContent");

  box.innerHTML = `
    <p><b>‡§®‡§æ‡§Æ:</b> ${d.applicantName}</p>
    <p><b>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ:</b> ${d.fatherName}</p>
    <p><b>‡§∏‡§Æ‡§ó‡•ç‡§∞ ID:</b> ${d.samagraId}</p>
    <p><b>‡§Ü‡§ß‡§æ‡§∞:</b> ${d.aadhaar}</p>
    <p><b>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</b> ${d.mobile}</p>
    <p><b>‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§Ü‡§Ø:</b> ‚Çπ ${d.annualIncome}</p>
    <p><b>‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</b> ${d.status}</p>
    <p><b>‡§∏‡•á‡§µ‡§æ:</b> ${d.serviceType}</p>
  `;

  document.getElementById("detailModal").classList.remove("hidden");
  document.getElementById("detailModal").classList.add("flex");
};

// ‚ùå Close modal
window.closeModal = function () {
  document.getElementById("detailModal").classList.add("hidden");
};
</script>

</body>
</html>
