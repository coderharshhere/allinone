
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <style>
                body {
                  background-color: white; /* Ensure the iframe has a white background */
                }

                
              </style>
                        </head>
                        <body>
                            <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Admin Dashboard - Form Management</title>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- SheetJS for Excel Export -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<!-- jsPDF for PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
.animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #764ba2, #667eea); }
#dashboard-view { display: none; }
.modal { transition: opacity 0.3s ease, transform 0.3s ease; }
body.modal-active { overflow-x: hidden; overflow-y: hidden !important; }
#drawer-notif-list::-webkit-scrollbar { width: 6px; }
.status-badge-green { background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); }
.status-badge-red { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); }
.status-badge-yellow { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3); }
.status-badge-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); }
.card-hover { transition: all 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2); }
.btn-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
.btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
.btn-gradient:active { transform: translateY(0); }
.glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
.notification-badge { position: absolute; top: -4px; right: -4px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; font-size: 10px; font-weight: bold; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
.table-row-hover:hover { background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); }
.badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
.fab { position: fixed; bottom: 40px; right: 40px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5); cursor: pointer; transition: all 0.3s ease; z-index: 100; }
.fab:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.7); }
.fab i { width: 28px; height: 28px; }
.search-container { position: relative; }
.search-container input { padding-left: 36px; width: 100%; }
.search-container i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; }
.form-card { transition: all 0.3s ease; border: 1px solid #e2e8f0; }
.form-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); border-color: #cbd5e1; }
.icon-preview { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-size: 24px; }
.category-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
.drag-handle { cursor: move; opacity: 0.7; transition: opacity 0.2s; }
.drag-handle:hover { opacity: 1; }
.sortable-ghost { opacity: 0.5; background: #f1f5f9; }
.sortable-chosen { background: #dbeafe; }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 text-gray-900 h-screen overflow-hidden">
<!-- ================= MESSAGE BOX ================= -->
<div id="message-box" class="fixed inset-0 z-[200] flex items-center justify-center hidden">
<div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
<div class="bg-white p-6 rounded-2xl shadow-2xl z-10 max-w-sm w-full mx-4 transform animate-fade-in border border-gray-100">
<div class="flex items-start mb-4">
<div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
<i data-lucide="info" class="w-5 h-5 text-blue-600"></i>
</div>
<div class="flex-1">
<h3 id="msg-title" class="text-lg font-bold text-gray-800 mb-1">Notice</h3>
<p id="msg-body" class="text-gray-600 text-sm leading-relaxed"></p>
</div>
</div>
<button onclick="closeMsg()" class="w-full py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg">Understood</button>
</div>
</div>

<!-- ================= CONFIRMATION MODAL ================= -->
<div id="confirm-modal" class="fixed inset-0 z-[210] flex items-center justify-center hidden">
<div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
<div class="bg-white p-6 rounded-2xl shadow-2xl z-10 max-w-md w-full mx-4 transform animate-fade-in border border-gray-100">
<div class="flex items-start mb-4">
<div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center mr-3 flex-shrink-0">
<i data-lucide="alert-triangle" class="w-5 h-5 text-red-600"></i>
</div>
<div class="flex-1">
<h3 id="confirm-title" class="text-lg font-bold text-gray-800 mb-2">Are you sure?</h3>
<p id="confirm-body" class="text-gray-600 text-sm leading-relaxed mb-4"></p>
<div class="flex gap-3">
<button onclick="cancelConfirm()" class="flex-1 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-all">Cancel</button>
<button onclick="executeConfirm()" id="confirm-btn" class="flex-1 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-medium hover:from-red-700 hover:to-red-800 transition-all shadow-lg">Confirm</button>
</div>
</div>
</div>
</div>
</div>

<!-- ================= SECURITY LOADER ================= -->
<div id="auth-loader" class="fixed inset-0 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
<div class="relative">
<div class="animate-spin rounded-full h-16 w-16 border-4 border-white/30 border-t-white"></div>
<div class="absolute inset-0 flex items-center justify-center">
<div class="w-8 h-8 rounded-full bg-white animate-pulse"></div>
</div>
</div>
<p class="mt-6 text-white font-bold text-lg">Verifying Access...</p>
<p class="text-white/80 text-sm mt-2">Checking Super Admin Privileges</p>
</div>

<!-- ================= DASHBOARD VIEW ================= -->
<div id="dashboard-view" class="w-full h-full flex">
<!-- Sidebar -->
<aside id="sidebar" class="w-64 bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 text-white transition-all duration-300 flex flex-col shadow-2xl z-20">
<div class="h-16 flex items-center justify-center border-b border-slate-700/50">
<span id="brand-full" class="text-xl font-bold tracking-wider uppercase flex items-center">
<span class="bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Super</span>
<span class="ml-1 text-white/90">Admin</span>
</span>
</div>
<nav class="flex-1 py-6 space-y-1 overflow-y-auto max-h-[calc(100vh-120px)]">
<button onclick="switchTab('dashboard')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-blue-500 bg-slate-800/50 text-blue-400" data-tab="dashboard">
<i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Dashboard</span>
<span class="bg-blue-500/20 text-blue-300 text-xs px-2 py-0.5 rounded-full">New</span>
</button>
<button onclick="switchTab('forms')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-transparent text-slate-300 hover:bg-slate-800 hover:text-white transition-all" data-tab="forms">
<i data-lucide="file-text" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Form Management</span>
</button>
<button onclick="switchTab('create-form')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-transparent text-slate-300 hover:bg-slate-800 hover:text-white transition-all" data-tab="create-form">
<i data-lucide="file-plus" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Add Application</span>
</button>
<button onclick="switchTab('admins')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-transparent text-slate-300 hover:bg-slate-800 hover:text-white transition-all" data-tab="admins">
<i data-lucide="users" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Admin Management</span>
</button>
<button onclick="switchTab('analytics')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-transparent text-slate-300 hover:bg-slate-800 hover:text-white transition-all" data-tab="analytics">
<i data-lucide="bar-chart-2" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Analytics</span>
</button>
<button onclick="switchTab('settings')" class="nav-item w-full flex items-center px-6 py-3 text-sm font-medium border-l-4 border-transparent text-slate-300 hover:bg-slate-800 hover:text-white transition-all" data-tab="settings">
<i data-lucide="settings" class="w-5 h-5 mr-3"></i>
<span class="flex-1 text-left">Settings</span>
</button>
</nav>
<div class="p-4 border-t border-slate-700/50 space-y-3">
<div class="flex items-center justify-between text-xs">
<span class="text-slate-400 flex items-center">
<i data-lucide="cloud" class="w-3 h-3 mr-1"></i>
Live Cloud Sync
</span>
<span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
</div>
<button onclick="logoutSystem()" class="flex items-center justify-center text-red-400 hover:text-red-300 transition-colors w-full text-sm font-medium py-2.5 rounded-lg hover:bg-slate-800/50 cursor-pointer group">
<i data-lucide="log-out" class="w-4 h-4 mr-2 group-hover:animate-pulse"></i> Logout System
</button>
</div>
</aside>

<!-- Main Content -->
<div class="flex-1 flex flex-col h-screen overflow-hidden">
<!-- Header -->
<header class="h-16 bg-white shadow-sm flex items-center justify-between px-6 z-10">
<div class="flex items-center space-x-4">
<h2 id="page-title" class="text-xl font-bold text-gray-800 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Overview</h2>
<span class="text-xs bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 px-3 py-1 rounded-full font-medium">v2.1</span>
</div>
<div class="flex items-center space-x-4">
<div class="search-container hidden md:block">
<input type="text" id="search-input" placeholder="Search applications..." class="w-64 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" oninput="searchApplications()">
<i data-lucide="search" class="w-4 h-4"></i>
</div>
<button onclick="openNotif()" class="relative p-2 hover:bg-gray-100 rounded-lg transition-all group">
<i data-lucide="bell" class="w-5 h-5 text-gray-600 group-hover:text-blue-600"></i>
<span id="notif-count" class="notification-badge hidden">0</span>
</button>
<div class="flex items-center space-x-3 border-l pl-4 ml-2">
<div class="w-9 h-9 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold shadow-md">SA</div>
<div class="hidden md:block text-left">
<p id="admin-email-display" class="font-medium text-gray-700 text-sm truncate max-w-[150px]">Loading...</p>
<p class="text-xs text-gray-400">Super Admin</p>
</div>
</div>
</div>
</header>

<!-- Main Content Area -->
<main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6 relative">
<!-- Toast -->
<div id="toast" class="hidden fixed top-20 right-6 z-[150] animate-slide-up">
<div class="px-5 py-3 rounded-xl shadow-xl flex items-center space-x-3 text-white bg-gradient-to-r from-green-600 to-emerald-600">
<i data-lucide="check-circle" class="w-5 h-5"></i>
<span id="toast-message" class="text-sm font-semibold">Success</span>
</div>
</div>

<!-- Loading Overlay -->
<div id="loading" class="hidden absolute inset-0 bg-white/90 z-40 flex flex-col items-center justify-center backdrop-blur-sm">
<div class="relative">
<div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
<div class="absolute inset-0 flex items-center justify-center">
<div class="w-4 h-4 rounded-full bg-blue-600 animate-pulse"></div>
</div>
</div>
<p class="mt-4 text-gray-600 font-medium">Processing Request...</p>
</div>

<!-- Floating Action Button -->
<div class="fab" onclick="openQuickActions()" title="Quick Actions">
<i data-lucide="plus"></i>
</div>

<!-- Quick Actions Menu -->
<div id="quick-actions-menu" class="fixed bottom-24 right-10 bg-white rounded-xl shadow-2xl p-3 z-[99] hidden animate-fade-in border border-gray-100">
<button onclick="switchTab('forms'); closeQuickActions()" class="flex items-center w-full px-3 py-2.5 hover:bg-gray-50 rounded-lg transition-all group">
<i data-lucide="file-text" class="w-5 h-5 text-indigo-600 mr-2"></i>
<span class="text-sm font-medium text-gray-700 group-hover:text-indigo-600">Manage Forms</span>
</button>
<button onclick="switchTab('create-form'); closeQuickActions()" class="flex items-center w-full px-3 py-2.5 hover:bg-gray-50 rounded-lg transition-all group">
<i data-lucide="file-plus" class="w-5 h-5 text-blue-600 mr-2"></i>
<span class="text-sm font-medium text-gray-700 group-hover:text-blue-600">New Application</span>
</button>
<button onclick="toggleModal('add-admin-modal'); closeQuickActions()" class="flex items-center w-full px-3 py-2.5 hover:bg-gray-50 rounded-lg transition-all group">
<i data-lucide="user-plus" class="w-5 h-5 text-green-600 mr-2"></i>
<span class="text-sm font-medium text-gray-700 group-hover:text-green-600">Add Admin</span>
</button>
<button onclick="publishNotification(); closeQuickActions()" class="flex items-center w-full px-3 py-2.5 hover:bg-gray-50 rounded-lg transition-all group">
<i data-lucide="megaphone" class="w-5 h-5 text-purple-600 mr-2"></i>
<span class="text-sm font-medium text-gray-700 group-hover:text-purple-600">Broadcast</span>
</button>
<button onclick="exportData('excel'); closeQuickActions()" class="flex items-center w-full px-3 py-2.5 hover:bg-gray-50 rounded-lg transition-all group">
<i data-lucide="download" class="w-5 h-5 text-orange-600 mr-2"></i>
<span class="text-sm font-medium text-gray-700 group-hover:text-orange-600">Export Data</span>
</button>
</div>

<!-- MODALS -->
<div id="add-admin-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[120]">
<div class="absolute w-full h-full bg-gray-900/60 backdrop-blur-sm" onclick="toggleModal('add-admin-modal')"></div>
<div class="bg-white w-full max-w-md mx-4 rounded-2xl shadow-2xl z-50 overflow-hidden animate-fade-in border border-gray-100">
<div class="p-6 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50">
<h3 class="text-xl font-bold text-gray-800 flex items-center">
<i data-lucide="user-plus" class="w-5 h-5 mr-2 text-blue-600"></i>
Add New Admin
</h3>
<p class="text-sm text-gray-500 mt-1">Create a new administrator account</p>
</div>
<div class="p-6">
<form id="new-admin-form" class="space-y-4">
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
<input type="text" id="new-admin-firstname" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="John">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
<input type="text" id="new-admin-lastname" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Doe">
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label>
<input type="email" id="new-admin-email" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="admin@example.com" required>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Password <span class="text-red-500">*</span></label>
<input type="password" id="new-admin-password" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Min. 8 characters" required minlength="8">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password <span class="text-red-500">*</span></label>
<input type="password" id="new-admin-confirm-password" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Re-enter password" required>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Role & Permissions</label>
<select id="new-admin-role" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white">
<option value="super_admin">Super Admin (Full Access)</option>
<option value="admin" selected>Standard Admin (Manage Applications)</option>
<option value="moderator">Moderator (View Only)</option>
</select>
</div>
<div class="mt-6 flex gap-3">
<button type="button" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-all" onclick="toggleModal('add-admin-modal')">Cancel</button>
<button type="submit" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold transition-all shadow-lg">Create Account</button>
</div>
</form>
</div>
</div>
</div>

<!-- FORM MANAGEMENT MODAL -->
<div id="form-management-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[130]">
<div class="absolute w-full h-full bg-gray-900/60 backdrop-blur-sm" onclick="toggleModal('form-management-modal')"></div>
<div class="bg-white w-full max-w-2xl mx-4 rounded-2xl shadow-2xl z-50 overflow-hidden animate-fade-in border border-gray-100">
<div class="p-6 border-b border-gray-100 bg-gradient-to-r from-indigo-50 to-purple-50">
<h3 id="form-modal-title" class="text-xl font-bold text-gray-800 flex items-center">
<i data-lucide="file-text" class="w-5 h-5 mr-2 text-indigo-600"></i>
<span>Add New Form</span>
</h3>
<p class="text-sm text-gray-500 mt-1">Manage form details and visibility on the website</p>
</div>
<div class="p-6 max-h-[70vh] overflow-y-auto">
<form id="form-management-form" class="space-y-5">
<input type="hidden" id="form-id">
<div class="grid grid-cols-1 md:grid-cols-2 gap-5">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Form Title (Hindi) <span class="text-red-500">*</span></label>
<input type="text" id="form-title-hi" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="समग्र ई-केवाईसी" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Form Title (English)</label>
<input type="text" id="form-title-en" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Samagra E-KYC">
</div>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Description (Hindi) <span class="text-red-500">*</span></label>
<textarea id="form-desc-hi" rows="2" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="समग्र आईडी में आधार लिंक करने की प्रक्रिया।" required></textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Description (English)</label>
<textarea id="form-desc-en" rows="2" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Process to link Aadhaar with Samagra ID."></textarea>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-5">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Category <span class="text-red-500">*</span></label>
<select id="form-category" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
<option value="social">समग्र एवं सामाजिक (Social)</option>
<option value="land">भू-अभिलेख (Land Records)</option>
<option value="certificates">प्रमाण पत्र (Certificates)</option>
<option value="form">यूनिवर्सिटी/फार्म (University/Form)</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icon Class <span class="text-red-500">*</span></label>
<input type="text" id="form-icon" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="fas fa-id-card" required>
<div class="mt-1 text-xs text-gray-500">Use Font Awesome classes (e.g., fas fa-id-card)</div>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-5">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Form Link (HTML file) <span class="text-red-500">*</span></label>
<input type="text" id="form-link" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="samagr.html" required>
<div class="mt-1 text-xs text-gray-500">Example: samagr.html, incomeform.html</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Display Order</label>
<input type="number" id="form-order" class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="1" min="1" value="1">
</div>
</div>

<div class="flex items-center space-x-3">
<input type="checkbox" id="form-active" class="custom-checkbox" checked>
<label for="form-active" class="text-sm font-medium text-gray-700">Active (Visible on website)</label>
</div>

<div class="pt-4 border-t">
<div class="flex gap-3">
<button type="button" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-all" onclick="toggleModal('form-management-modal')">Cancel</button>
<button type="submit" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 font-bold transition-all shadow-lg">Save Form Details</button>
</div>
</div>
</form>
</div>
</div>
</div>

<div class="max-w-7xl mx-auto">
<!-- VIEW: DASHBOARD -->
<div id="view-dashboard" class="space-y-6 animate-fade-in">
<!-- Notification Publisher -->
<div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 max-w-xl card-hover">
<h3 class="font-bold text-gray-800 mb-4 flex items-center">
<i data-lucide="megaphone" class="w-5 h-5 mr-2 text-blue-600"></i> 
<span>Publish Announcement</span>
<span class="ml-2 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">Global</span>
</h3>
<div class="space-y-3">
<input id="notif-title" type="text" placeholder="Title (e.g., Server Maintenance)" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 mb-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
<textarea id="notif-message" rows="4" placeholder="Detailed message for all users..." class="w-full border border-gray-200 rounded-lg px-4 py-2.5 mb-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none transition-all"></textarea>
<div class="flex gap-3">
<button onclick="publishNotification()" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-2.5 rounded-lg font-bold hover:from-blue-700 hover:to-indigo-700 transition-all flex items-center justify-center shadow-lg">
<i data-lucide="send" class="w-4 h-4 mr-2"></i> Post Notification
</button>
<button onclick="clearNotificationForm()" class="px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">
<i data-lucide="x" class="w-4 h-4 mr-1"></i> Clear
</button>
</div>
</div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
<div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 card-hover">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500 text-xs font-medium uppercase tracking-wider">Total Entries</p>
<h3 id="stat-total" class="text-3xl font-bold text-gray-800 mt-1">0</h3>
<p class="text-xs text-gray-400 mt-1">All time applications</p>
</div>
<div class="p-3 bg-blue-100 text-blue-600 rounded-xl"><i data-lucide="files" class="w-6 h-6"></i></div>
</div>
</div>
<div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 card-hover">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500 text-xs font-medium uppercase tracking-wider">Pending</p>
<h3 id="stat-pending" class="text-3xl font-bold text-yellow-600 mt-1">0</h3>
<p class="text-xs text-gray-400 mt-1">Awaiting review</p>
</div>
<div class="p-3 bg-yellow-100 text-yellow-600 rounded-xl"><i data-lucide="clock" class="w-6 h-6"></i></div>
</div>
</div>
<div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 card-hover">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500 text-xs font-medium uppercase tracking-wider">Accepted</p>
<h3 id="stat-accepted" class="text-3xl font-bold text-green-600 mt-1">0</h3>
<p class="text-xs text-gray-400 mt-1">Successfully processed</p>
</div>
<div class="p-3 bg-green-100 text-green-600 rounded-xl"><i data-lucide="check-circle" class="w-6 h-6"></i></div>
</div>
</div>
<div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 card-hover">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500 text-xs font-medium uppercase tracking-wider">Rejected</p>
<h3 id="stat-rejected" class="text-3xl font-bold text-red-600 mt-1">0</h3>
<p class="text-xs text-gray-400 mt-1">Declined applications</p>
</div>
<div class="p-3 bg-red-100 text-red-600 rounded-xl"><i data-lucide="x-circle" class="w-6 h-6"></i></div>
</div>
</div>
<div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 card-hover">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500 text-xs font-medium uppercase tracking-wider">Active Admins</p>
<h3 id="stat-users" class="text-3xl font-bold text-purple-600 mt-1">0</h3>
<p class="text-xs text-gray-400 mt-1">Currently online</p>
</div>
<div class="p-3 bg-purple-100 text-purple-600 rounded-xl"><i data-lucide="users" class="w-6 h-6"></i></div>
</div>
</div>
</div>

<!-- Quick Actions Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-6 rounded-2xl shadow-lg text-white card-hover">
<div class="flex justify-between items-start">
<div>
<h4 class="font-bold text-lg mb-1">Quick Actions</h4>
<p class="text-blue-100 text-sm">Manage your workflow</p>
</div>
<i data-lucide="zap" class="w-8 h-8 opacity-80"></i>
</div>
<div class="mt-4 grid grid-cols-2 gap-3">
<button onclick="switchTab('forms')" class="bg-white/10 hover:bg-white/20 backdrop-blur-sm p-3 rounded-lg text-sm font-medium transition-all flex flex-col items-center justify-center">
<i data-lucide="file-text" class="w-5 h-5 mb-1"></i>
<span>Forms</span>
</button>
<button onclick="switchTab('create-form')" class="bg-white/10 hover:bg-white/20 backdrop-blur-sm p-3 rounded-lg text-sm font-medium transition-all flex flex-col items-center justify-center">
<i data-lucide="file-plus" class="w-5 h-5 mb-1"></i>
<span>Add Form</span>
</button>
<button onclick="toggleModal('add-admin-modal')" class="bg-white/10 hover:bg-white/20 backdrop-blur-sm p-3 rounded-lg text-sm font-medium transition-all flex flex-col items-center justify-center">
<i data-lucide="user-plus" class="w-5 h-5 mb-1"></i>
<span>Add Admin</span>
</button>
<button onclick="exportData('excel')" class="bg-white/10 hover:bg-white/20 backdrop-blur-sm p-3 rounded-lg text-sm font-medium transition-all flex flex-col items-center justify-center">
<i data-lucide="download" class="w-5 h-5 mb-1"></i>
<span>Export</span>
</button>
</div>
</div>

<div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl shadow-lg text-white card-hover">
<div class="flex justify-between items-start">
<div>
<h4 class="font-bold text-lg mb-1">System Health</h4>
<p class="text-green-100 text-sm">Performance metrics</p>
</div>
<i data-lucide="activity" class="w-8 h-8 opacity-80"></i>
</div>
<div class="mt-4 space-y-3">
<div class="flex justify-between text-sm">
<span>Database</span>
<span class="font-bold">98%</span>
</div>
<div class="flex justify-between text-sm">
<span>API Response</span>
<span class="font-bold">99%</span>
</div>
<div class="flex justify-between text-sm">
<span>Storage</span>
<span class="font-bold">75%</span>
</div>
</div>
</div>

<div class="bg-gradient-to-br from-purple-500 to-pink-600 p-6 rounded-2xl shadow-lg text-white card-hover">
<div class="flex justify-between items-start">
<div>
<h4 class="font-bold text-lg mb-1">Recent Activity</h4>
<p class="text-purple-100 text-sm">Latest updates</p>
</div>
<i data-lucide="trending-up" class="w-8 h-8 opacity-80"></i>
</div>
<div class="mt-4 space-y-3">
<div class="flex items-center">
<i data-lucide="check" class="w-4 h-4 text-green-300 mr-2"></i>
<span class="text-sm">New application submitted</span>
</div>
<div class="flex items-center">
<i data-lucide="file-text" class="w-4 h-4 text-blue-300 mr-2"></i>
<span class="text-sm">Form updated successfully</span>
</div>
<div class="flex items-center">
<i data-lucide="user-plus" class="w-4 h-4 text-blue-300 mr-2"></i>
<span class="text-sm">Admin account created</span>
</div>
<div class="flex items-center">
<i data-lucide="bell" class="w-4 h-4 text-yellow-300 mr-2"></i>
<span class="text-sm">Notification broadcasted</span>
</div>
</div>
</div>
</div>

<!-- Data Breakdown & Table -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 card-hover">
<h3 class="font-bold text-gray-800 mb-5 flex items-center">
<i data-lucide="pie-chart" class="w-5 h-5 mr-2 text-blue-600"></i> Forms Breakdown
</h3>
<div id="service-breakdown" class="space-y-4">
<div class="text-sm text-gray-400 italic">Calculating...</div>
</div>
</div>

<div class="lg:col-span-2 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden card-hover">
<div class="p-5 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center bg-gradient-to-r from-blue-50 to-indigo-50 gap-4">
<div>
<h3 class="font-bold text-gray-800 text-lg">Recent Applications</h3>
<p class="text-xs text-gray-500 mt-1">Last 10 entries • Live Sync</p>
</div>
<div class="flex gap-2">
<button onclick="filterStatus('all')" class="px-3 py-1.5 text-xs bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all">All</button>
<button onclick="filterStatus('pending')" class="px-3 py-1.5 text-xs bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 transition-all">Pending</button>
<button onclick="filterStatus('accepted')" class="px-3 py-1.5 text-xs bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all">Accepted</button>
<button onclick="filterStatus('rejected')" class="px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all">Rejected</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="w-full text-left">
<thead class="bg-gray-50 text-gray-500 text-xs font-bold uppercase tracking-wider border-b">
<tr>
<th class="px-6 py-4">Type / Reference</th>
<th class="px-6 py-4">Applicant Details</th>
<th class="px-6 py-4">Status</th>
<th class="px-6 py-4 text-right">Actions</th>
</tr>
</thead>
<tbody id="forms-table-body" class="divide-y divide-gray-100">
<tr><td colspan="4" class="p-12 text-center text-gray-400">Fetching applications...</td></tr>
</tbody>
</table>
</div>
<div class="p-4 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
<button onclick="exportData('excel')" class="text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center">
<i data-lucide="download" class="w-4 h-4 mr-1"></i> Export All Data
</button>
<span class="text-xs text-gray-500">Updated in real-time</span>
</div>
</div>
</div>
</div>

<!-- VIEW: FORM MANAGEMENT -->
<div id="view-forms" class="hidden animate-fade-in">
<div class="space-y-6">
<!-- Header Section -->
<div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
<div>
<h2 class="text-2xl font-bold text-gray-800">Form Management</h2>
<p class="text-gray-500 mt-1">Manage all forms displayed on your website. Add, edit, or deactivate forms as needed.</p>
</div>
<div class="flex gap-3">
<div class="search-container w-64">
<input type="text" id="form-search" placeholder="Search forms..." class="w-full px-4 py-2.5 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-sm" oninput="searchForms()">
<i data-lucide="search" class="w-4 h-4"></i>
</div>
<button onclick="openFormModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-6 py-2.5 rounded-xl text-sm font-bold flex items-center justify-center transition-all shadow-lg">
<i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add New Form
</button>
</div>
</div>
</div>

<!-- Forms Grid -->
<div id="forms-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<!-- Forms will be dynamically loaded here -->
<div class="text-center py-12 text-gray-400">
<div class="animate-spin rounded-full h-12 w-12 border-4 border-indigo-200 border-t-indigo-600 mx-auto mb-4"></div>
<p class="text-lg font-medium">Loading forms...</p>
</div>
</div>

<!-- Category Legend -->
<div class="bg-white rounded-2xl shadow-lg p-5 card-hover">
<h3 class="font-bold text-gray-800 mb-4 flex items-center">
<i data-lucide="tag" class="w-5 h-5 mr-2 text-indigo-600"></i> Category Legend
</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="flex items-center">
<span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>
<span class="text-sm text-gray-700">Social</span>
</div>
<div class="flex items-center">
<span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
<span class="text-sm text-gray-700">Land Records</span>
</div>
<div class="flex items-center">
<span class="w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
<span class="text-sm text-gray-700">Certificates</span>
</div>
<div class="flex items-center">
<span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>
<span class="text-sm text-gray-700">University/Form</span>
</div>
</div>
</div>
</div>
</div>

<!-- VIEW: ADD FORM -->
<div id="view-create-form" class="hidden animate-fade-in">
<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden card-hover">
<div class="p-7 border-b border-gray-100 bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
<h2 class="text-2xl font-bold flex items-center">
<i data-lucide="file-plus" class="w-6 h-6 mr-3"></i> Manual Application Entry
</h2>
<p class="text-blue-100 text-sm mt-2">Create a new record directly in the system.</p>
</div>
<form id="admin-entry-form" class="p-8 space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Service Category <span class="text-red-500">*</span></label>
<select id="entry-service" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none bg-white transition-all">
<option value="">-- Select Service --</option>
<option value="Income Certificate">Income Certificate (आय प्रमाण पत्र)</option>
<option value="Samagra ID">Samagra ID (समग्र आईडी)</option>
<option value="MP Bhoj">MP Bhoj Form (एमपी भोज)</option>
<option value="Pan Card">Pan Card (पैन कार्ड)</option>
<option value="Aadhaar Update">Aadhaar Update (आधार सुधार)</option>
<option value="Domicile Certificate">Domicile Certificate (मूल निवासी)</option>
<option value="Caste Certificate">Caste Certificate (जाति प्रमाण पत्र)</option>
<option value="Birth Certificate">Birth Certificate (जन्म प्रमाण पत्र)</option>
<option value="Marriage Certificate">Marriage Certificate (विवाह प्रमाण पत्र)</option>
<option value="Death Certificate">Death Certificate (मृत्यु प्रमाण पत्र)</option>
<option value="Driving License">Driving License (ड्राइविंग लाइसेंस)</option>
<option value="Voter ID">Voter ID (मतदाता पहचान पत्र)</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Full Name <span class="text-red-500">*</span></label>
<input type="text" id="entry-name" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Enter applicant name" required>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Contact Email <span class="text-red-500">*</span></label>
<input type="email" id="entry-email" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="email@example.com" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
<input type="tel" id="entry-phone" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="+91 9876543210" pattern="[0-9]{10}">
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Aadhaar Number</label>
<input type="text" id="entry-aadhaar" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="XXXX-XXXX-XXXX" maxlength="14">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Address (Optional)</label>
<textarea id="entry-address" rows="2" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Full address"></textarea>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">District</label>
<input type="text" id="entry-district" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="District name">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">State</label>
<input type="text" id="entry-state" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="State name" value="Madhya Pradesh">
</div>
</div>

<div class="pt-6 border-t">
<div class="flex gap-4">
<button type="submit" class="flex-1 py-4 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold hover:from-blue-700 hover:to-indigo-700 shadow-xl shadow-blue-200 transition-all flex justify-center items-center gap-2">
<i data-lucide="save" class="w-5 h-5"></i> Finalize & Submit Application
</button>
<button type="button" onclick="resetForm()" class="px-6 py-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all flex items-center gap-2">
<i data-lucide="refresh-ccw" class="w-5 h-5"></i> Reset Form
</button>
</div>
</form>
</div>
</div>
</div>

<!-- Other views (admins, analytics, settings) remain minimal for brevity -->
<div id="view-admins" class="hidden animate-fade-in">
<div class="bg-white rounded-2xl shadow-lg p-6">
<h2 class="text-xl font-bold text-gray-800 mb-4">Admin Management</h2>
<p class="text-gray-500 mb-6">This section would show admin management interface</p>
<div id="admins-table-container" class="overflow-x-auto">
<table class="w-full text-left">
<thead class="bg-gray-50 text-gray-500 text-xs font-bold uppercase tracking-wider">
<tr>
<th class="px-6 py-4">Identity</th>
<th class="px-6 py-4">Role</th>
<th class="px-6 py-4">Status</th>
<th class="px-6 py-4 text-right">Actions</th>
</tr>
</thead>
<tbody id="admins-table-body" class="divide-y divide-gray-100">
<tr><td colspan="4" class="p-10 text-center text-gray-400">Loading admin ledger...</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="view-analytics" class="hidden animate-fade-in">
<div class="bg-white rounded-2xl shadow-lg p-6">
<h2 class="text-xl font-bold text-gray-800 mb-4">Analytics Dashboard</h2>
<p class="text-gray-500 mb-6">This section would show analytics and reports</p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="p-6 bg-gray-50 rounded-xl">
<h3 class="font-bold text-gray-800 mb-4">Export Data</h3>
<div class="grid grid-cols-2 gap-4">
<button onclick="exportData('csv')" class="p-4 border-2 border-blue-200 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-all">
<div class="font-medium text-gray-700 mb-2">Export as CSV</div>
</button>
<button onclick="exportData('excel')" class="p-4 border-2 border-green-200 rounded-xl hover:border-green-400 hover:bg-green-50 transition-all">
<div class="font-medium text-gray-700 mb-2">Export as Excel</div>
</button>
<button onclick="exportData('pdf')" class="p-4 border-2 border-red-200 rounded-xl hover:border-red-400 hover:bg-red-50 transition-all">
<div class="font-medium text-gray-700 mb-2">Export as PDF</div>
</button>
<button onclick="exportData('json')" class="p-4 border-2 border-purple-200 rounded-xl hover:border-purple-400 hover:bg-purple-50 transition-all">
<div class="font-medium text-gray-700 mb-2">Export as JSON</div>
</button>
</div>
</div>
<div class="p-6 bg-gray-50 rounded-xl">
<h3 class="font-bold text-gray-800 mb-4">Status Distribution</h3>
<div id="analytics-service-breakdown" class="space-y-4">
Loading analytics...
</div>
</div>
</div>
</div>
</div>

<div id="view-settings" class="hidden animate-fade-in">
<div class="bg-white rounded-2xl shadow-lg p-6">
<h2 class="text-xl font-bold text-gray-800 mb-4">System Settings</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="p-4 bg-blue-50 rounded-lg">
<h3 class="font-medium text-blue-800 mb-2">Firebase Project</h3>
<p class="text-sm text-blue-600 break-all">allinone-aa89</p>
</div>
<div class="p-4 bg-green-50 rounded-lg">
<h3 class="font-medium text-green-800 mb-2">Database</h3>
<p class="text-sm text-green-600">Cloud Firestore</p>
</div>
<div class="p-4 bg-purple-50 rounded-lg">
<h3 class="font-medium text-purple-800 mb-2">Current Version</h3>
<p class="text-sm text-purple-600">v2.1.0</p>
</div>
<div class="p-4 bg-orange-50 rounded-lg">
<h3 class="font-medium text-orange-800 mb-2">Last Updated</h3>
<p class="text-sm text-orange-600" id="last-updated">Loading...</p>
</div>
</div>
</div>
</div>
</div>
</main>
</div>
</div>

<!-- NOTIFICATION DRAWER -->
<div id="notif-drawer" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl z-[210] transform translate-x-full transition-transform duration-300 border-l border-gray-100">
<div class="p-5 bg-gradient-to-r from-slate-900 to-slate-800 text-white flex justify-between items-center">
<div>
<h3 class="font-bold text-lg flex items-center">
<i data-lucide="bell" class="w-5 h-5 mr-2"></i> Notifications
</h3>
<p class="text-xs opacity-70 mt-1">Broadcast history & alerts</p>
</div>
<button onclick="closeNotif()" class="p-2 hover:bg-slate-700 rounded-lg transition-colors">
<i data-lucide="x" class="w-5 h-5"></i>
</button>
</div>

<div class="p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
<div class="text-sm font-medium text-gray-700">Recent Broadcasts</div>
<button onclick="clearAllNotifications()" class="text-xs text-red-600 hover:text-red-700 font-medium flex items-center">
<i data-lucide="trash-2" class="w-3 h-3 mr-1"></i> Clear All
</button>
</div>

<div id="drawer-notif-list" class="p-4 space-y-3 overflow-y-auto h-[calc(100%-100px)]">
<div class="text-center text-gray-400 py-12">
<i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-3 opacity-20"></i>
<p class="text-sm font-medium">No notifications yet</p>
<p class="text-xs text-gray-500 mt-1">Create your first announcement</p>
</div>
</div>

<div class="absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100">
<button onclick="closeNotif(); switchTab('dashboard')" class="w-full py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg flex items-center justify-center">
<i data-lucide="home" class="w-4 h-4 mr-2"></i> Back to Dashboard
</button>
</div>
</div>

<!-- FIREBASE & LOGIC -->
<script type="module">
// ✅ FIXED: Removed trailing spaces from import URLs
import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
import { getFirestore, collection, addDoc, updateDoc, getDoc, setDoc, doc, onSnapshot, serverTimestamp, deleteDoc, query, orderBy, where, getDocs } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';

// --- Firebase Configuration ---
const firebaseConfig = {
apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
authDomain: "allinone-aa89.firebaseapp.com",
projectId: "allinone-aa89",
storageBucket: "allinone-aa89.appspot.com",
messagingSenderId: "924003122498",
appId: "1:924003122498:web:2c86505457236e60055cdb",
measurementId: "G-45N39T3BB6"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- Paths ---
const APPS_PATH   = collection(db, 'applications');
const ADMINS_PATH = collection(db, 'admins');
const NOTIF_PATH  = collection(db, 'notifications');
const FORMS_PATH  = collection(db, 'forms'); // New collection for forms

// --- State ---
let applications = [];
let adminList = [];
let formsList = [];
let filteredApplications = [];
let filteredAdmins = [];
let filteredForms = [];
let currentFilter = 'all';
let unsubscribeApps, unsubscribeAdmins, unsubscribeNotifs, unsubscribeForms;
let confirmCallback = null;

// --- Auth Setup ---
onAuthStateChanged(auth, async (user) => {
const authLoader = document.getElementById("auth-loader");
const dashboardView = document.getElementById("dashboard-view");

if (!user) {
location.href = "adminlogin.html";
return;
}

try {
const adminRef = doc(db, "admins", user.uid);
const snap = await getDoc(adminRef);

if (!snap.exists()) {
alert("Access denied");
await signOut(auth);
location.href = "adminlogin.html";
return;
}

const admin = snap.data();
if (admin.role !== "super_admin" || admin.status !== "active") {
alert("Only Super Admin allowed");
await signOut(auth);
location.href = "adminlogin.html";
return;
}

// ✅ SUCCESS
document.getElementById("admin-email-display").innerText =
user.email || `Admin-${user.uid.slice(0, 5)}`;

authLoader.style.opacity = "0";
setTimeout(() => {
authLoader.style.display = "none";
dashboardView.style.display = "flex";
setupListeners(user.uid);
document.getElementById('last-updated').innerText = new Date().toLocaleString();
}, 300);
} catch (err) {
console.error(err);
alert("Admin verification failed");
await signOut(auth);
location.href = "adminlogin.html";
}
});

function setupListeners(uid) {
// Admins
unsubscribeAdmins = onSnapshot(ADMINS_PATH, (snap) => {
adminList = snap.docs.map(d => ({ id: d.id, ...d.data() }));
filteredAdmins = [...adminList];
document.getElementById("stat-users").innerText = adminList.filter(a => a.status === 'active').length;
document.getElementById("admin-total-count")?.innerText = adminList.length;
document.getElementById("admin-active-count")?.innerText = adminList.filter(a => a.status === 'active').length;
renderAdmins();
}, (err) => console.error("Admin Listener Error", err));

// Applications
unsubscribeApps = onSnapshot(APPS_PATH, (snap) => {
applications = snap.docs.map(d => ({ id: d.id, ...d.data() }));
filteredApplications = [...applications];

let stats = { total: applications.length, pending: 0, accepted: 0, rejected: 0 };
let serviceCounts = {};

applications.forEach(data => {
const st = (data.status || "pending").toLowerCase();
if (stats.hasOwnProperty(st)) stats[st]++;
const type = data.serviceType || data.formType || "Other";
serviceCounts[type] = (serviceCounts[type] || 0) + 1;
});

updateStatsUI(stats);
renderServiceBreakdown(serviceCounts, stats.total);
renderTable();
applyCurrentFilter();
});

// Notifications
const notifQuery = query(NOTIF_PATH, orderBy("createdAt", "desc"));
unsubscribeNotifs = onSnapshot(notifQuery, (snap) => {
const drawer = document.getElementById("drawer-notif-list");
const countBadge = document.getElementById("notif-count");

let activeNotifs = snap.docs.filter(d => d.data().active !== false);

if (activeNotifs.length === 0) {
drawer.innerHTML = `
<div class="text-center py-12 text-gray-400">
<i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-3 opacity-20"></i>
<p class="text-sm font-medium">No notifications yet</p>
<p class="text-xs text-gray-500 mt-1">Create your first announcement</p>
</div>`;
countBadge.classList.add('hidden');
} else {
countBadge.innerText = activeNotifs.length;
countBadge.classList.remove('hidden');

drawer.innerHTML = activeNotifs.map(docSnap => {
const n = docSnap.data();
const date = n.createdAt?.seconds ? new Date(n.createdAt.seconds * 1000) : new Date();
return `
<div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all group">
<div class="flex justify-between items-start mb-2">
<div>
<h4 class="font-bold text-gray-800 text-sm">${n.title || 'No title'}</h4>
<span class="text-[10px] text-blue-600 font-medium mt-1">${n.createdBy || 'Admin'}</span>
</div>
<button onclick="deleteNotif('${docSnap.id}')" class="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100">
<i data-lucide="trash-2" class="w-4 h-4"></i>
</button>
</div>
<p class="text-xs text-gray-600 leading-relaxed mb-2">${n.message || 'No message'}</p>
<div class="flex items-center justify-between pt-2 border-t border-gray-100">
<span class="text-[10px] text-gray-400">${date.toLocaleDateString()} • ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
<span class="text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded">Global</span>
</div>
</div>`;
}).join('');
}
lucide.createIcons();
});

// Forms Management
unsubscribeForms = onSnapshot(FORMS_PATH, (snap) => {
formsList = snap.docs.map(d => ({ id: d.id, ...d.data() }));
// ✅ FIXED: Corrected sorting syntax
filteredForms = [...formsList].sort((a, b) => {
const orderA = a.order || 0;
const orderB = b.order || 0;
return orderA - orderB;
});
renderFormsGrid();
}, (err) => console.error("Forms Listener Error", err));
}

// --- Form Management Functions ---
window.openFormModal = function(formId = null) {
const modalTitle = document.getElementById('form-modal-title');
const form = document.getElementById('form-management-form');
form.reset();
document.getElementById('form-id').value = '';
document.getElementById('form-active').checked = true;
document.getElementById('form-order').value = formsList.length + 1;

if (formId) {
const formDoc = formsList.find(f => f.id === formId);
if (formDoc) {
modalTitle.innerHTML = `<i data-lucide="edit" class="w-5 h-5 mr-2 text-indigo-600"></i>Edit Form: ${formDoc.titleHi || formDoc.titleEn}`;
document.getElementById('form-id').value = formDoc.id;
document.getElementById('form-title-hi').value = formDoc.titleHi || '';
document.getElementById('form-title-en').value = formDoc.titleEn || '';
document.getElementById('form-desc-hi').value = formDoc.descHi || '';
document.getElementById('form-desc-en').value = formDoc.descEn || '';
document.getElementById('form-category').value = formDoc.category || 'social';
document.getElementById('form-icon').value = formDoc.icon || 'fas fa-file';
document.getElementById('form-link').value = formDoc.link || '';
document.getElementById('form-order').value = formDoc.order || 1;
document.getElementById('form-active').checked = formDoc.active !== false;
lucide.createIcons();
}
} else {
modalTitle.innerHTML = `<i data-lucide="file-plus" class="w-5 h-5 mr-2 text-indigo-600"></i>Add New Form`;
}

toggleModal('form-management-modal');
};

window.saveForm = async function(e) {
e.preventDefault();
const formId = document.getElementById('form-id').value;
const formData = {
titleHi: document.getElementById('form-title-hi').value.trim(),
titleEn: document.getElementById('form-title-en').value.trim(),
descHi: document.getElementById('form-desc-hi').value.trim(),
descEn: document.getElementById('form-desc-en').value.trim(),
category: document.getElementById('form-category').value,
icon: document.getElementById('form-icon').value.trim(),
link: document.getElementById('form-link').value.trim(),
order: parseInt(document.getElementById('form-order').value) || 1,
active: document.getElementById('form-active').checked,
updatedAt: serverTimestamp(),
updatedBy: auth.currentUser?.email || "Admin"
};

if (!formData.titleHi || !formData.descHi || !formData.icon || !formData.link) {
showMsg("Validation Error", "Please fill all required fields marked with *");
return;
}

try {
setLoading(true);
if (formId) {
// Update existing form
await updateDoc(doc(db, 'forms', formId), formData);
showToast("Form updated successfully!");
} else {
// Add new form
formData.createdAt = serverTimestamp();
formData.createdBy = auth.currentUser?.email || "Admin";
await addDoc(FORMS_PATH, formData);
showToast("New form added successfully!");
}
toggleModal('form-management-modal');
document.getElementById('form-management-form').reset();
} catch (e) {
console.error(e);
showMsg("Error", "Failed to save form: " + e.message);
}
finally {
setLoading(false);
}
};

window.deleteForm = function(formId) {
showConfirm("Delete Form", "Are you sure you want to delete this form? This will remove it from your website.", async () => {
try {
await deleteDoc(doc(db, 'forms', formId));
showToast("Form deleted successfully");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to delete form");
}
});
};

window.toggleFormStatus = async function(formId) {
try {
const formDoc = formsList.find(f => f.id === formId);
if (!formDoc) return;

const newStatus = !(formDoc.active !== false);
await updateDoc(doc(db, 'forms', formId), { 
active: newStatus,
updatedAt: serverTimestamp()
});

showToast(`Form ${newStatus ? 'activated' : 'deactivated'} successfully`);
} catch (e) {
console.error(e);
showMsg("Error", "Failed to update form status");
}
};

function renderFormsGrid() {
const container = document.getElementById('forms-grid');
if (!container) return;

if (filteredForms.length === 0) {
container.innerHTML = `
<div class="col-span-full text-center py-12">
<i data-lucide="file-text" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
<p class="text-gray-500 text-lg font-medium">No forms available</p>
<p class="text-gray-400 mt-2">Click "Add New Form" to create your first form</p>
<button onclick="openFormModal()" class="mt-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-2.5 rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all shadow-md">
<i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>Add First Form
</button>
</div>`;
lucide.createIcons();
return;
}

container.innerHTML = filteredForms.map(form => {
const categoryColors = {
'social': 'bg-blue-500',
'land': 'bg-green-500',
'certificates': 'bg-orange-500',
'form': 'bg-purple-500'
};
const categoryBadges = {
'social': 'समग्र एवं सामाजिक',
'land': 'भू-अभिलेख',
'certificates': 'प्रमाण पत्र',
'form': 'यूनिवर्सिटी/फार्म'
};
const iconClass = form.icon || 'fas fa-file';
const isActive = form.active !== false;
const categoryColor = categoryColors[form.category] || 'bg-gray-500';

return `
<div class="form-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
<div class="p-5 border-b border-gray-100 flex items-start justify-between">
<div class="flex items-start flex-1">
<div class="icon-preview ${isActive ? categoryColor : 'bg-gray-300'} text-white mr-4">
<i class="${iconClass}"></i>
</div>
<div class="flex-1">
<h3 class="font-bold text-gray-800 text-lg">${form.titleHi || form.titleEn || 'Untitled Form'}</h3>
<p class="text-sm text-gray-600 mt-1">${form.descHi || form.descEn || ''}</p>
</div>
</div>
<div class="drag-handle p-2 text-gray-400 hover:text-gray-600">
<i data-lucide="grip-vertical" class="w-5 h-5"></i>
</div>
</div>
<div class="p-4 bg-gray-50 border-t border-gray-100">
<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
<div class="flex items-center">
<span class="category-badge ${isActive ? categoryColor : 'bg-gray-300'} text-white">
${categoryBadges[form.category] || form.category}
</span>
<span class="ml-3 text-xs text-gray-500">Order: ${form.order || 1}</span>
</div>
<div class="flex items-center space-x-2">
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" class="sr-only peer" ${isActive ? 'checked' : ''} onchange="toggleFormStatus('${form.id}')">
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
</label>
<div class="flex space-x-2">
<button onclick="openFormModal('${form.id}')" class="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" title="Edit">
<i data-lucide="edit" class="w-4 h-4"></i>
</button>
<button onclick="deleteForm('${form.id}')" class="p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Delete">
<i data-lucide="trash-2" class="w-4 h-4"></i>
</button>
</div>
</div>
</div>
<div class="mt-3 pt-3 border-t border-gray-100">
<a href="${form.link || '#'}" target="_blank" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium flex items-center">
<i data-lucide="external-link" class="w-3 h-3 mr-1"></i>
${form.link || 'No link configured'}
</a>
</div>
</div>
</div>`;
}).join('');

lucide.createIcons();
}

window.searchForms = function() {
const searchTerm = document.getElementById('form-search').value.toLowerCase();
filteredForms = formsList.filter(form => 
(form.titleHi?.toLowerCase().includes(searchTerm) ||
form.titleEn?.toLowerCase().includes(searchTerm) ||
form.descHi?.toLowerCase().includes(searchTerm) ||
form.descEn?.toLowerCase().includes(searchTerm) ||
form.category?.toLowerCase().includes(searchTerm) ||
form.link?.toLowerCase().includes(searchTerm))
).sort((a, b) => {
const orderA = a.order || 0;
const orderB = b.order || 0;
return orderA - orderB;
});
renderFormsGrid();
};

// --- Other Actions ---
window.publishNotification = async () => {
const title = document.getElementById("notif-title").value.trim();
const message = document.getElementById("notif-message").value.trim();

if (!title || !message) return showMsg("Input Required", "Title and message cannot be empty.");

try {
setLoading(true);
await addDoc(NOTIF_PATH, {
title, message, active: true,
createdAt: serverTimestamp(),
createdBy: auth.currentUser?.email || "Admin"
});
document.getElementById("notif-title").value = "";
document.getElementById("notif-message").value = "";
showToast("Notice Published Successfully!");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to broadcast notice.");
}
finally { setLoading(false); }
};

window.clearNotificationForm = () => {
document.getElementById("notif-title").value = "";
document.getElementById("notif-message").value = "";
};

window.submitManualEntry = async (e) => {
e.preventDefault();
const formData = {
serviceType: document.getElementById('entry-service').value,
applicantName: document.getElementById('entry-name').value,
email: document.getElementById('entry-email').value,
phone: document.getElementById('entry-phone')?.value || '',
aadhaar: document.getElementById('entry-aadhaar').value,
address: document.getElementById('entry-address')?.value || '',
district: document.getElementById('entry-district')?.value || '',
state: document.getElementById('entry-state')?.value || ''
};

if (!formData.serviceType) {
showMsg("Error", "Please select a service category");
return;
}

try {
setLoading(true);
const docRef = await addDoc(APPS_PATH, {
...formData,
status: "pending",
createdAt: serverTimestamp(),
applicationNumber: "AIO-" + Math.random().toString(36).substring(2, 10).toUpperCase(),
createdBy: auth.currentUser?.email || "Admin"
});
showToast("Application Saved Successfully!");
e.target.reset();
switchTab('dashboard');
} catch (e) {
console.error(e);
showMsg("Failure", "Database write rejected.");
}
finally { setLoading(false); }
};

window.updateAppStatus = async (id, status) => {
try {
await updateDoc(doc(db, 'applications', id), { status: status.toLowerCase() });
showToast(`Application marked as ${status}`);
} catch (e) {
console.error(e);
showMsg("Error", "Failed to update status");
}
};

window.deleteNotif = async (id) => {
showConfirm("Delete Notification", "Are you sure you want to delete this notification?", async () => {
try {
await updateDoc(doc(db, 'notifications', id), { active: false });
showToast("Notification removed successfully");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to delete notification");
}
});
};

window.deleteAdmin = async (id, email) => {
showConfirm("Delete Admin", `Revoke all admin rights for ${email}? This action cannot be undone.`, async () => {
try {
await deleteDoc(doc(db, 'admins', id));
showToast("Admin access revoked successfully");
} catch (e) {
console.error(e);
showMsg("Error", "Insufficient permissions to delete user.");
}
});
};

// ✅ FIXED: Changed getDocs(query(NOTIF_PATH)) to getDocs(NOTIF_PATH)
window.clearAllNotifications = function() {
showConfirm("Clear All Notifications", "Are you sure you want to clear all notifications?", async () => {
try {
const notifSnapshot = await getDocs(NOTIF_PATH);
for (const docSnap of notifSnapshot.docs) {
await updateDoc(doc(db, 'notifications', docSnap.id), { active: false });
}
showToast("All notifications cleared");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to clear notifications");
}
});
};

// UI Helpers
function updateStatsUI(s) {
document.getElementById('stat-total').innerText = s.total;
document.getElementById('stat-pending').innerText = s.pending;
document.getElementById('stat-accepted').innerText = s.accepted;
document.getElementById('stat-rejected').innerText = s.rejected;
}

function renderTable() {
const tbody = document.getElementById('forms-table-body');
if (applications.length === 0) {
tbody.innerHTML = `<tr><td colspan="4" class="p-20 text-center text-gray-300 italic">No applications found in the ledger</td></tr>`;
return;
}

const displayApps = filteredApplications.slice(0, 10);

tbody.innerHTML = displayApps.map(app => {
const s = app.status || 'pending';
let badgeClass = 'status-badge-yellow';
if (s === 'accepted') badgeClass = 'status-badge-green';
if (s === 'rejected') badgeClass = 'status-badge-red';

const formType = app.serviceType || app.formType || 'Unknown Service';
const date = app.createdAt?.seconds ? new Date(app.createdAt.seconds * 1000) : null;

return `
<tr class="table-row-hover transition-colors">
<td class="px-6 py-4">
<div class="font-bold text-gray-800 text-sm">${formType}</div>
<div class="text-[10px] font-mono text-blue-600 mt-1">${app.applicationNumber || 'REF-N/A'}</div>
</td>
<td class="px-6 py-4">
<div class="text-sm font-medium text-gray-700">${app.applicantName || 'No name'}</div>
<div class="text-[10px] text-gray-500 mt-1">${app.email || 'No Email'}</div>
${app.phone ? `<div class="text-[10px] text-gray-400">📱 ${app.phone}</div>` : ''}
</td>
<td class="px-6 py-4">
<span class="inline-flex items-center px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider ${badgeClass}">
${s.charAt(0).toUpperCase() + s.slice(1)}
</span>
</td>
<td class="px-6 py-4 text-right space-x-2">
${s === 'pending' ? `
<button onclick="updateAppStatus('${app.id}', 'Accepted')" class="p-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-600 hover:text-white transition-all" title="Accept">
<i data-lucide="check" class="w-4 h-4"></i>
</button>
<button onclick="updateAppStatus('${app.id}', 'Rejected')" class="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-all" title="Reject">
<i data-lucide="x" class="w-4 h-4"></i>
</button>
` : `<span class="text-[10px] text-gray-400 italic">Processed</span>`}
</td>
</tr>`;
}).join('');

lucide.createIcons();
}

function renderAdmins() {
const container = document.getElementById('admins-table-body');
if (!container) return;
if (adminList.length === 0) {
container.innerHTML = `<tr><td colspan="4" class="p-10 text-center text-gray-400">No admin accounts found</td></tr>`;
return;
}

const displayAdmins = filteredAdmins;

container.innerHTML = displayAdmins.map(a => {
const isActive = a.status === 'active';
const isSelf = auth.currentUser && auth.currentUser.uid === a.id;

return `
<tr class="hover:bg-gray-50 transition-colors">
<td class="px-6 py-4">
<div class="font-medium text-gray-800 text-sm">${a.firstname || ''} ${a.lastname || ''}</div>
<div class="text-[10px] text-gray-500 mt-1">${a.email || 'Anonymous User'}</div>
</td>
<td class="px-6 py-4">
<span class="px-3 py-1 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 rounded-full text-[10px] font-bold uppercase tracking-wider">
${a.role === 'super_admin' ? 'Super Admin' : a.role === 'admin' ? 'Admin' : 'Moderator'}
</span>
</td>
<td class="px-6 py-4">
<span class="flex items-center text-[10px] font-bold ${isActive ? 'text-green-600' : 'text-red-600'} uppercase">
<span class="w-2 h-2 rounded-full bg-current mr-2 ${isActive ? 'animate-pulse' : ''}"></span>
${a.status || 'Active'}
</span>
</td>
<td class="px-6 py-4 text-right space-x-2">
${!isSelf ? `
<button onclick="deleteAdmin('${a.id}', '${a.email}')" class="text-red-600 hover:text-red-800 p-1" title="Delete">
<i data-lucide="trash-2" class="w-4 h-4"></i>
</button>
` : `<span class="text-[10px] italic text-gray-400">Self</span>`}
</td>
</tr>`;
}).join('');

lucide.createIcons();
}

function renderServiceBreakdown(counts, total) {
const container = document.getElementById('service-breakdown');
const analyticsContainer = document.getElementById('analytics-service-breakdown');

if (total === 0) {
if (container) container.innerHTML = `<p class="text-xs text-gray-400">Waiting for data...</p>`;
if (analyticsContainer) analyticsContainer.innerHTML = `<p class="text-xs text-gray-400">No data available</p>`;
return;
}

const entries = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 6);

if (entries.length === 0) {
if (container) container.innerHTML = `<p class="text-xs text-gray-400">No service data available</p>`;
if (analyticsContainer) analyticsContainer.innerHTML = `<p class="text-xs text-gray-400">No analytics data</p>`;
return;
}

// Main dashboard breakdown
if (container) {
container.innerHTML = entries.map(([name, count], index) => {
const perc = Math.round((count / total) * 100);
const colors = ['bg-blue-600', 'bg-purple-600', 'bg-green-600', 'bg-yellow-600', 'bg-red-600', 'bg-indigo-600'];
return `
<div class="space-y-2">
<div class="flex justify-between text-xs font-bold text-gray-700">
<span class="flex items-center">
<span class="w-2 h-2 ${colors[index]} rounded-full mr-2"></span>
${name}
</span>
<span>${count} (${perc}%)</span>
</div>
<div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
<div class="${colors[index]} h-full rounded-full transition-all duration-500" style="width: ${perc}%"></div>
</div>
</div>`;
}).join('');
}

// Analytics breakdown
if (analyticsContainer) {
analyticsContainer.innerHTML = entries.map(([name, count], index) => {
const perc = Math.round((count / total) * 100);
return `
<div class="p-4 bg-gray-50 rounded-lg">
<div class="flex justify-between text-sm font-bold text-gray-800 mb-2">
<span>${name}</span>
<span>${count} applications</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-2">
<div class="bg-blue-600 h-2 rounded-full" style="width: ${perc}%"></div>
</div>
<div class="text-xs text-gray-500 mt-1">${perc}% of total</div>
</div>`;
}).join('');
}
}

// Search & Filter Functions
window.searchApplications = function() {
const searchTerm = document.getElementById('search-input').value.toLowerCase();
filteredApplications = applications.filter(app => {
const formType = app.serviceType || app.formType || '';
return (
formType.toLowerCase().includes(searchTerm) ||
app.applicantName?.toLowerCase().includes(searchTerm) ||
app.email?.toLowerCase().includes(searchTerm) ||
app.applicationNumber?.toLowerCase().includes(searchTerm) ||
app.phone?.includes(searchTerm)
);
});
renderTable();
};

window.searchAdmins = function() {
const searchTerm = document.getElementById('admin-search')?.value.toLowerCase() || '';
filteredAdmins = adminList.filter(admin => 
(admin.email?.toLowerCase().includes(searchTerm) ||
admin.firstname?.toLowerCase().includes(searchTerm) ||
admin.lastname?.toLowerCase().includes(searchTerm))
);
renderAdmins();
};

window.filterStatus = function(status) {
currentFilter = status;
applyCurrentFilter();
};

function applyCurrentFilter() {
if (currentFilter === 'all') {
filteredApplications = [...applications];
} else {
filteredApplications = applications.filter(app => 
(app.status || 'pending').toLowerCase() === currentFilter.toLowerCase()
);
}
renderTable();
}

// Export Functions
window.exportData = function(format) {
if (applications.length === 0) {
showMsg("No Data", "No applications to export");
return;
}

const exportData = applications.map(app => ({
'Application Number': app.applicationNumber || 'N/A',
'Service Type': app.serviceType || app.formType || 'Unknown',
'Applicant Name': app.applicantName || 'N/A',
'Email': app.email || 'N/A',
'Phone': app.phone || 'N/A',
'Aadhaar': app.aadhaar || 'N/A',
'District': app.district || 'N/A',
'State': app.state || 'N/A',
'Status': app.status || 'pending',
'Created At': app.createdAt?.seconds ? new Date(app.createdAt.seconds * 1000).toLocaleString() : 'N/A'
}));

if (format === 'csv') {
exportCSV(exportData);
} else if (format === 'excel') {
exportExcel(exportData);
} else if (format === 'pdf') {
exportPDF(exportData);
} else if (format === 'json') {
exportJSON(exportData);
}
};

function exportCSV(data) {
try {
const csv = convertToCSV(data);
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
link.setAttribute('href', url);
link.setAttribute('download', `applications_${new Date().getTime()}.csv`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showToast("CSV exported successfully!");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to export CSV");
}
}

function exportExcel(data) {
try {
const ws = XLSX.utils.json_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "Applications");
XLSX.writeFile(wb, `applications_${new Date().getTime()}.xlsx`);
showToast("Excel file exported successfully!");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to export Excel file");
}
}

function exportPDF(data) {
try {
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.setFontSize(16);
doc.text("Applications Report", 14, 15);
doc.setFontSize(10);
doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 22);

let y = 30;
data.slice(0, 20).forEach((app, index) => {
if (y > 280 && index < data.length - 1) {
doc.addPage();
y = 15;
}
doc.setFontSize(8);
doc.text(`${index + 1}. ${app['Application Number']} - ${app['Service Type']}`, 14, y);
doc.text(`Name: ${app['Applicant Name']}`, 14, y + 4);
doc.text(`Status: ${app['Status']}`, 14, y + 8);
y += 15;
});

doc.save(`applications_${new Date().getTime()}.pdf`);
showToast("PDF exported successfully!");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to export PDF");
}
}

function exportJSON(data) {
try {
const json = JSON.stringify(data, null, 2);
const blob = new Blob([json], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
link.setAttribute('href', url);
link.setAttribute('download', `applications_${new Date().getTime()}.json`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showToast("JSON exported successfully!");
} catch (e) {
console.error(e);
showMsg("Error", "Failed to export JSON");
}
}

function convertToCSV(objArray) {
const array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
let str = '';
for (let i = 0; i < array.length; i++) {
let line = '';
for (let index in array[i]) {
if (line !== '') line += ',';
line += `"${array[i][index]}"`;
}
str += line + '\r\n';
}
return str;
}

window.exportAdmins = function() {
if (adminList.length === 0) {
showMsg("No Data", "No admins to export");
return;
}

const exportData = adminList.map(admin => ({
'Email': admin.email || 'N/A',
'First Name': admin.firstname || 'N/A',
'Last Name': admin.lastname || 'N/A',
'Role': admin.role || 'admin',
'Status': admin.status || 'active',
'Created At': admin.createdAt?.seconds ? new Date(admin.createdAt.seconds * 1000).toLocaleString() : 'N/A'
}));

const csv = convertToCSV(exportData);
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
link.setAttribute('href', url);
link.setAttribute('download', `admins_${new Date().getTime()}.csv`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showToast("Admin list exported successfully!");
};

// Confirmation Modal
window.showConfirm = function(title, message, callback) {
document.getElementById('confirm-title').innerText = title;
document.getElementById('confirm-body').innerText = message;
confirmCallback = callback;
document.getElementById('confirm-modal').classList.remove('hidden');
};

window.cancelConfirm = function() {
document.getElementById('confirm-modal').classList.add('hidden');
confirmCallback = null;
};

window.executeConfirm = function() {
if (confirmCallback) {
confirmCallback();
}
cancelConfirm();
};

// Quick Actions
window.openQuickActions = function() {
document.getElementById('quick-actions-menu').classList.toggle('hidden');
};

window.closeQuickActions = function() {
document.getElementById('quick-actions-menu').classList.add('hidden');
};

// Global Utility Functions
window.switchTab = (tabId) => {
document.querySelectorAll('.nav-item').forEach(el => {
const isActive = el.dataset.tab === tabId;
el.classList.toggle('border-blue-500', isActive);
el.classList.toggle('bg-slate-800/50', isActive);
el.classList.toggle('text-blue-400', isActive);
el.classList.toggle('border-transparent', !isActive);
el.classList.toggle('text-slate-300', !isActive);
});

['dashboard', 'forms', 'create-form', 'admins', 'analytics', 'settings'].forEach(t => {
const view = document.getElementById(`view-${t}`);
if (view) view.classList.add('hidden');
});

const view = document.getElementById(`view-${tabId}`);
if (view) view.classList.remove('hidden');

const titles = {
'dashboard': 'Dashboard Overview',
'forms': 'Form Management',
'create-form': 'Add New Application',
'admins': 'Admin Management',
'analytics': 'Analytics & Reports',
'settings': 'System Settings'
};

document.getElementById('page-title').innerText = titles[tabId] || 'Dashboard';
document.getElementById('search-input').value = '';
filteredApplications = [...applications];
currentFilter = 'all';
};

window.toggleModal = (id) => {
const el = document.getElementById(id);
if (!el) return;

const isOpen = el.classList.contains('opacity-0');
el.classList.toggle('opacity-0', !isOpen);
el.classList.toggle('pointer-events-none', !isOpen);
document.body.classList.toggle('modal-active', isOpen);

if (isOpen) {
setTimeout(() => {
el.querySelector('input')?.focus();
}, 300);
}
};

window.showToast = (msg) => {
const el = document.getElementById('toast');
const toastMsg = document.getElementById('toast-message');
if (!el || !toastMsg) return;

toastMsg.innerText = msg;
el.classList.remove('hidden');

setTimeout(() => {
el.classList.add('hidden');
}, 4000);
};

window.showMsg = (title, body) => {
const titleEl = document.getElementById('msg-title');
const bodyEl = document.getElementById('msg-body');
const msgBox = document.getElementById('message-box');

if (titleEl) titleEl.innerText = title;
if (bodyEl) bodyEl.innerText = body;
if (msgBox) msgBox.classList.remove('hidden');
};

window.closeMsg = () => {
const msgBox = document.getElementById('message-box');
if (msgBox) msgBox.classList.add('hidden');
};

window.openNotif = () => {
const drawer = document.getElementById("notif-drawer");
if (drawer) drawer.classList.remove("translate-x-full");
};

window.closeNotif = () => {
const drawer = document.getElementById("notif-drawer");
if (drawer) drawer.classList.add("translate-x-full");
};

window.logoutSystem = async () => {
if (unsubscribeApps) unsubscribeApps();
if (unsubscribeAdmins) unsubscribeAdmins();
if (unsubscribeNotifs) unsubscribeNotifs();
if (unsubscribeForms) unsubscribeForms();

await signOut(auth);
localStorage.removeItem('admin_auth_token');
location.reload();
};

function setLoading(val) {
const loadingEl = document.getElementById('loading');
if (loadingEl) loadingEl.classList.toggle('hidden', !val);
}

function resetForm() {
document.getElementById('admin-entry-form').reset();
showToast("Form reset successfully");
}

// Initialize form handlers
document.addEventListener('DOMContentLoaded', () => {
const adminForm = document.getElementById('admin-entry-form');
if (adminForm) {
adminForm.addEventListener('submit', window.submitManualEntry);
}

const newAdminForm = document.getElementById('new-admin-form');
if (newAdminForm) {
newAdminForm.addEventListener('submit', async (e) => {
e.preventDefault();
const firstname = document.getElementById('new-admin-firstname')?.value;
const lastname = document.getElementById('new-admin-lastname')?.value;
const email = document.getElementById('new-admin-email')?.value;
const password = document.getElementById('new-admin-password')?.value;
const confirmPassword = document.getElementById('new-admin-confirm-password')?.value;
const role = document.getElementById('new-admin-role')?.value;

if (!email || !password) {
showMsg("Error", "Email and password are required");
return;
}

if (password !== confirmPassword) {
showMsg("Error", "Passwords do not match");
return;
}

if (password.length < 8) {
showMsg("Error", "Password must be at least 8 characters");
return;
}

try {
setLoading(true);
const userCredential = await createUserWithEmailAndPassword(auth, email, password);
const userId = userCredential.user.uid;

await setDoc(doc(db, 'admins', userId), {
firstname, lastname, email,
role: role || 'admin',
status: 'active',
createdAt: serverTimestamp(),
createdBy: auth.currentUser?.email || "System"
});

showToast("Admin account created successfully!");
toggleModal('add-admin-modal');
e.target.reset();
} catch (err) {
console.error(err);
showMsg("Error", "Failed to register new admin: " + err.message);
}
finally { setLoading(false); }
});
}

const formManagementForm = document.getElementById('form-management-form');
if (formManagementForm) {
formManagementForm.addEventListener('submit', window.saveForm);
}

lucide.createIcons();
});
</script>
</body>
</html>



              <script>
                                   import { ... } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js  ";
     
     import { ... } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
     
     // Before (caused error)
     filteredForms = [...formsList].sort((a, b) => (a.order || 0) - (b.order || 0));
     
     // After (corrected)
     filteredForms = [...formsList].sort((a, b) => {
         const orderA = a.order || 0;
         const orderB = b.order || 0;
         return orderA - orderB;
     });
     
     const notifSnapshot = await getDocs(query(NOTIF_PATH));
     
     const notifSnapshot = await getDocs(NOTIF_PATH);
     

              </script>
                        </body>
                        </html>
                    
