<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>आय प्रमाण पत्र आवेदन | AllInOne MP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap');
    body { font-family: 'Noto Sans Devanagari', sans-serif; }
    .form-input{width:100%;border:1px solid #d1d5db;border-radius:.5rem;padding:.5rem}
  </style>
</head>
<body class="bg-gray-50">
<div id="header.html"></div>
<main class="container mx-auto px-4 py-10">
  <form id="incomeForm" class="bg-white p-6 rounded-xl shadow space-y-6">

    <input type="text" name="applicantName" placeholder="नाम" required class="form-input" />
    <input type="text" name="fatherName" placeholder="Father Name" required class="form-input" />
    <input type="text" name="samagraId" placeholder="Samagra ID" required class="form-input" />
    <input type="text" name="aadhaar" placeholder="Aadhaar" required class="form-input" />

    <input type="email" name="email" placeholder="Email" required class="form-input" />
    <input type="tel" name="mobile" placeholder="Mobile" required class="form-input" />

    <select name="occupation" required class="form-input">
      <option value="">Occupation</option>
      <option>Service</option>
      <option>Business</option>
    </select>

    <input type="number" name="annualIncome" placeholder="Annual Income" required class="form-input" />
    <textarea name="fullAddress" placeholder="Full Address" required class="form-input"></textarea>

    <button type="submit" class="bg-blue-700 text-white px-6 py-2 rounded">Submit</button>
  </form>
</main>
<div id="footer.html"></div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-iZvVroV-H6aRs7X-mlnt_ra3_vnaNzg",
    authDomain: "allinone-aa89.firebaseapp.com",
    projectId: "allinone-aa89",
    storageBucket: "allinone-aa89.firebasestorage.app",
    messagingSenderId: "924003122498",
    appId: "1:924003122498:web:2c86505457236e60055cdb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  emailjs.init("-HjIyXVqfuRKrznVE");

  function generateApplicationNumber(){
    return "AIO-" + Date.now().toString().slice(-8);
  }

  const form = document.getElementById("incomeForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const applicationNo = generateApplicationNumber();

    await addDoc(collection(db, "applications"), {
      applicationNo,
      applicantName: form.applicantName.value,
      fatherName: form.fatherName.value,
      samagraId: form.samagraId.value,
      aadhaar: form.aadhaar.value,
      email: form.email.value,
      mobile: form.mobile.value,
      occupation: form.occupation.value,
      annualIncome: form.annualIncome.value,
      fullAddress: form.fullAddress.value,
      status: "pending",
      createdAt: serverTimestamp()
    });

    alert("Form Submitted. Application No: " + applicationNo);

    emailjs.send("service_allinone", "template_application", {
      to_name: form.applicantName.value,
      to_email: form.email.value,
      application_no: applicationNo
    });

    form.reset();
  });
</script>

</body>
</html>
